Data Types in CICore
--------------------

.. module:: Types
   :synopsis: Catalog of data types (structures) used by the DataONE cicore.

**Quick Reference**

- :class:`Types.AccessPolicy`
- :class:`Types.AccessRule`
- :class:`Types.Boolean`
- :class:`Types.Checksum`
- :class:`Types.ChecksumAlgorithm`
- :class:`Types.DateTime`
- :class:`Types.DescribeResponse`
- :class:`Types.Event`
- :class:`Types.Group`
- :class:`Types.Identifier`
- :class:`Types.IdentifierFormat`
- :class:`Types.Integer`
- :class:`Types.Log`
- :class:`Types.LogEntry`
- :class:`Types.MonitorInfo`
- :class:`Types.MonitorList`
- :class:`Types.Node`
- :class:`Types.NodeHealth`
- :class:`Types.NodeList`
- :class:`Types.NodeReference`
- :class:`Types.ObjectFormat`
- :class:`Types.ObjectFormatIdentifier`
- :class:`Types.ObjectFormatList`
- :class:`Types.ObjectList`
- :class:`Types.ObjectLocation`
- :class:`Types.ObjectLocationList`
- :class:`Types.OctetStream`
- :class:`Types.Permission`
- :class:`Types.Person`
- :class:`Types.PingResponse`
- :class:`Types.Query`
- :class:`Types.RelationshipEnum`
- :class:`Types.Replica`
- :class:`Types.Session`
- :class:`Types.Subject`
- :class:`Types.SubjectList`
- :class:`Types.Status`
- :class:`Types.SystemMetadata`
- :class:`Types.X509Certificate`


**Overview Diagram**

.. image:: images/classes_combined.png

..
  @startuml images/classes_combined.png
  class AccessPolicy {
    + allow : AccessRule[0..*]
  }
  AccessPolicy o-- AccessRule
  
  class AccessRule {
    + subject : Subject[1..*]
    + permission : Permission[1..*]
  }
  AccessRule o-- Subject
  AccessRule o-- Permission

  enum ChecksumAlgorithm
  ChecksumAlgorithm : SHA-1
  ChecksumAlgorithm : SHA-224
  ChecksumAlgorithm : SHA-356
  ChecksumAlgorithm : SHA-384
  ChecksumAlgorithm : SHA-512
  ChecksumAlgorithm : MD5

  class Checksum {
      +algorithm : ChecksumAlgorithm
      +value : string
  }
  Checksum -- ChecksumAlgorithm

  class DescribeResponse {
    +DataONE-fmtid : ObjectFormatIdentifier
    +Content-Length : integer
    +Last-Modified : DateTime
    +DataONE-Checksum : Checksum
  }
  DescribeResponse -- ObjectFormatIdentifier
  DescribeResponse -- Checksum
  DescribeResponse -- DateTime

  enum Event
    Event : CREATE
    Event : READ
    Event : UPDATE
    Event : DELETE
    Event : REPLICATE
    Event : CHANGEOWNER

  class Group {
    + subject : Subject
    + groupName : NonEmptyString
    + hasMember : Subject[0..*]
  }
  Group o-- Subject
  Group -- NonEmptyString

  NonEmptyString <|-- Identifier

  enum IdentifierFormat
  IdentifierFormat : OID
  IdentifierFormat : LSID
  IdentifierFormat : UUID
  IdentifierFormat : LSRN
  IdentifierFormat : DOI
  IdentifierFormat : URI
  IdentifierFormat : STRING

  class LogEntry {
    + entryID : Identifier
    + identifier : Identifier
    + ipAddress : string
    + userAgent : string
    + subject : Subject
    + event : Event
    + dateLogged : DateTime
    + memberNode : NodeReference
  }
  LogEntry -- Identifier
  LogEntry -- Subject
  LogEntry -- Event
  LogEntry -- DateTime
  LogEntry -- NodeReference

  class Log {
    + start : integer
    + count : integer
    + total : integer
    + logEntry : LogEntry[0..]
  }
  Log o-- LogEntry

  NonEmptyString <|-- NodeReference

  class Node {
    identifier : NodeReference
    name : NodeReference
    description : NonEmptyString
    baseURL : anyURI
    services : Services[0..1]
    synchronization : Synchronization[0..1]
    health : Nodehealth[0..1]
    subject: Subject[0..*]
    replicate : boolean
    synchronize : boolean
    type : NodeType
  }
  Node -- NodeReference
  Node -- NonEmptyString
  Node o-- Services
  Node o-- Synchronization
  Node o-- NodeHealth
  Node -- NodeType

  class NodeHealth {
    ping : Ping
    status : Status
  }
  NodeHealth -- Ping
  NodeHealth -- Status

  class NodeList {
    node : Node[1..*]
  }
  NodeList o-- Node
  
  enum NodeType
    NodeType : cn 
    NodeType : mn
    NodeType : Monitor

  NonEmptyString <|-- ObjectFormatIdentifier

  class ObjectFormat {
    fmtid : ObjectFormatIdentifier
    formatName : string
    scienceMetadata: boolean
  }
  ObjectFormat -- ObjectFormatIdentifier

  class ObjectFormatList {
    start : integer
    count : integer
    total : integer
    objectFormat : ObjectFormat[1..*]
  }
  ObjectFormatList o-- ObjectFormat

  class ObjectInfo {
    + identifier : Identifier
  }
  ObjectInfo -- Identifier
  DescribeResponse <|-- ObjectInfo
  
  class ObjectList {
    objectInfo : ObjectInfo[0..*]
  }
  ObjectList o-- ObjectInfo

  class ObjectLocation {
    + nodeIdentifier : NodeReference
    + baseURL : anyURI
    + url : anyURI
    + preference : integer[0..1]
  }
  ObjectLocation -- NodeReference

  class ObjectLocationList {
    + identifier : Identifier
    + locations : ObjectLocation[0..*]
  }
  ObjectLocationList o-- ObjectLocation
  ObjectLocationList -- Identifier

  enum Permission
  Permission : READ
  Permission : WRITE
  Permission : CHANGEPERMISSION
  Permission : EXECUTE

  class Person {
    + subject : Subject
    + givenName : NonEmptyString
    + familyName : NonEmptyString
    + email : NonEmptyString
    + isMemberOf : Subject
    + equivalentIdentity : Subject[0..*]
  }
  Person o-- Subject
  Person -- NonEmptyString

  enum RelationshipEnum
  RelationshipEnum : DESCRIBES
  RelationshipEnum : DESCRIBED_BY
  RelationshipEnum : OBSOLETES
  RelationshipEnum : OBSOLETED_BY
  RelationshipEnum : DERIVED_FROM


  class Replica {
    + replicaMemberNode : NodeReference
    + replicationStatus : ReplicationStatus
    + replicaVerified : DateTime
  }
  Replica -- NodeReference
  Replica -- ReplicationStatus
  Replica -- DateTime

  enum ReplicationStatus
    ReplicationStatus : queued
    ReplicationStatus : requested
    ReplicationStatus : completed
    ReplicationStatus : invalidated

  class ReplicationPolicy {
    + preferredMemberNode : NodeReference[0..*]
    + blockedMemberNode : NodeReference[0..*]
    + replicationAllowed : Boolean
    + numberReplicas : Integer
  }
  ReplicationPolicy -- NodeReference

  class SuccessFlag {
    + value : boolean
  }

  class Schedule {
    + hour : CrontabEntry
    + mday : CrontabEntry
    + min : CrontabEntry
    + mon : CrontabEntry
    + sec : CrontabEntry
    + wday : CrontabEntry
    + year : CrontabEntry
  }
  Schedule -- CrontabEntry

  class Service {
    + name : ServiceName
    + method : ServiceMethod[0..*]
    + version : ServiceVersion
    + available : Boolean
  }
  Service -- ServiceName
  Service o-- ServiceMethod
  Service -- ServiceVersion

  class ServiceMethod {
    + name : NMTOKEN
    + rest : token
    + implemented : Boolean
  }

  NonEmptyString <|-- ServiceName

  class Services {
    + service : Service[1..*]
  }
  Services o-- Service

  NonEmptyString <|-- ServiceVersion

  class Session {
    + subject : Subject
    + subjectList : SubjectList[0..1]
  }
  Session o-- Subject
  Session o-- SubjectList

  NonEmptyString <|-- Subject

  class SubjectList {
    + person : Person[0..*]
    + group : Group[0..*]
  }
  SubjectList o-- Person
  SubjectList o-- Group

  class Synchronization {
    + schedule : Schedule
    + lastHarvested : DateTime
    + lastCompleteHarvest : DateTime
  }
  Synchronization -- Schedule
  Synchronization -- DateTime

  class SystemMetadata {
    + identifier : Identifier
    + fmtid : ObjectFormatIdentifier
    + size : long
    + checksum : Checksum
    + submitter : Subject
    + rightsHolder : Subject
    + accessPolicy : AccessPolicy[0..*]
    + replicationPolicy : ReplicationPolicy[0..*]
    + obsoletes : Identifier[0..*]
    + obsoletedBy : Identifier[0..*]
    + resourceMap : Identifier[0..*]
    + dateUploaded : dateTime
    + dateSysMetadataModified : dateTime
    + originMemberNode : NodeReference
    + authoritativeMemberNode : NodeReference
    + replica : Replica[0...*]
  }
  SystemMetadata o-- Identifier
  SystemMetadata -- ObjectFormatIdentifier
  SystemMetadata -- Subject
  SystemMetadata o-- AccessPolicy
  SystemMetadata o-- ReplicationPolicy
  SystemMetadata -- Checksum
  SystemMetadata -- NodeReference
  SystemMetadata o-- Replica
  @enduml



.. Note:: Here we use the Sphinx ``class`` directives to identify data
  structures. This is not meant to imply that these structures are implemented
  as classes - it is merely a convenience mechanism for documentation.



..                                    ######
.. class:: AccessPolicy

  A set of rules that specifies as a whole the allowable permissions that a
  given user or system has for accessing a resource, including both data and
  metadata resources and service resources. An access policy consists of a
  sequence of allow rules that grant permissions to principals, which can be
  individual users, groups of users, symbolic users, or systems and services.

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- AccessPolicy -->
     :end-before: <!-- AccessRule -->

  .. image:: images/class_accesspolicy.png

  .. 
    @startuml images/class_accesspolicy.png
    class AccessPolicy {
      + allow : AccessRule[0..*]
    }
    AccessPolicy o-- AccessRule    
    @enduml



..                                    ######
.. class:: AccessRule

  A rule that is used to allow a :term:`subject` to perform an action (such as
  read or write) on an object in DataONE. Rules are tuples (subject,
  permission) specifying which permissions are allowed for the subjects(s).
  The resource on which the access control rules are being applied is
  determined by the containing System Metadata document, or in the case of
  methods such as :func:`CNAuthorization.setAccessPolicy`, by the *pid* in the
  method parameters.

  Access control rules are specified by the :term:`Origin Member Node` when the
  object is first registered in DataONE. If no rules are specified at that
  time, then the object is deemed to be private and the only user with access
  to the object (read, write, or otherwise) is the :term:`Rights Holder`.

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- AccessRule -->
     :end-before: <!-- Checksum -->

  .. image:: images/class_accessrule.png

  ..
    @startuml images/class_accessrule.png
    class AccessRule {
      + subject : Subject[1..*]
      + permission : Permission[1..*]
    }
    AccessRule o-- Subject
    AccessRule o-- Permission
    @enduml



..                                    ######
.. class:: AuthenticationSystem

  Place holder for support of multiple authentication services for a single
  user.



..                                    ######
.. class:: OctetStream

   A series of 8-bit bytes which combined together form a digital object.
   *OctetStream* is used to transfer object bytes such as the response to
   :func:`MNRead.get`.



..                                    ######
.. class:: Integer

   A simple integer. The range of expected values should be described with the
   accompanying API call.

   The Integer type is serialized over XML using the predefined XMLSchema
   *integer_* type, the value space of which is the infinite series
   {...,-2,-1,0,1,2,...}.
   
.. _integer: http://www.w3.org/TR/xmlschema-2/#integer



..                                    ######
.. class:: Boolean

   A boolean response is commonly used in the DataONE service APIs to indicate
   success or otherwise of an operation. For operations that are called 
   through the service interfaces, a positive boolean response (i.e. True) is
   indicated by returning a HTTP response with a status code of "200". The 
   body of the message may contain additional content, but this should be 
   ignored by the receiver.

   A False or failure response must return an appropriate Error message and 
   must set the appropriate HTTP status code on the response to indicate a 
   failure.

   The Boolean type is serialized over XML using the predefined XMLSchema
   `boolean`_ type, an instance of which can have the following legal literals
   {true, false, 1, 0}.

.. _boolean: http://www.w3.org/TR/xmlschema-2/#boolean



..                                    ######
.. class:: Capabilities

  This class has been deprecated by :class:`Node`




..                                    ######
.. class:: Checksum

  Represents the value of a computed checksum.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
       :language: xml
       :start-after: <!-- Checksum -->
       :end-before: <!-- Component -->

  .. image:: images/class_checksum.png

  ..
    @startuml images/class_checksum.png
    class Checksum {
      +algorithm : ChecksumAlgorithm
      +value : string
    }
    enum ChecksumAlgorithm
    Checksum -- ChecksumAlgorithm
    @enduml



..                                    ######
.. class:: ChecksumAlgorithm

  An enumeration of checksum types supported by the DataONE infrastructure.

  The default checksum is *SHA-1*.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Checksum Algorithm -->
     :end-before: <!-- ComponentName -->

  .. image:: images/class_checksumalgorithm.png

  ..
    @startuml images/class_checksumalgorithm.png
    enum ChecksumAlgorithm
      ChecksumAlgorithm : SHA-1
      ChecksumAlgorithm : SHA-224
      ChecksumAlgorithm : SHA-356
      ChecksumAlgorithm : SHA-384
      ChecksumAlgorithm : SHA-512
      ChecksumAlgorithm : MD5
    @enduml



..                                    ######
.. class:: ComponentName

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- ComponentName -->
     :end-before: <!-- ComponentVersion -->




..                                    ######
.. class:: ComponentVersion

  As represented in XMLSchema:
  
  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- ComponentVersion -->
     :end-before: <!-- crontrabEntry -->



..                                    ######
.. class:: CrontabEntry

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
    :language: xml
    :start-after: <!-- crontrabEntry -->
    :end-before: <!-- Event Enumeration -->



..                                    ######
.. class:: DateTime

  A string that completely identifies a specific time.

  - Must include date and time
  - If not specified, then the time zone is 0, i.e. GMT

  Valid representations include:
  
  - `HTTP Full Date`_ format. e.g. `Sun, 06 Nov 1994 08:49:37 GMT`
  - `YYYY-MM-DDTHH:MM:SS.mmmmmm`
  - `YYYYMMDDTHHMMSS.mmmmmm`
  - `YYYY-MM-DDTHH:MM:SS.mmmmmm+HH:MM`
  - `YYYYMMDDTHHMMSS.mmmmmm+HHMM`

  The milliseconds may be left off if that precision is not available.

  In Java, code against `java.util.Date`_, though serialization and
  deserialization will be performed with `org.joda.DateTime`_ to ensure
  millisecond precision is .

  Implemented in Python using the `datetime.datetime`_ class, which is also
  used for serialization and deserialization through Pyxb_.

  See also the `XMLSchema dateTime`_ type which is used for serializing DateTime
  values in XML transmitted between DataONE components.

.. _HTTP Full Date: http://www.w3.org/Protocols/rfc2616/rfc2616-sec3.html#sec3.3.1

.. _XMLSchema dateTime: http://www.w3.org/TR/xmlschema-2/#dateTime

.. _java.util.Date: http://download.oracle.com/javase/6/docs/api/java/util/Date.html

.. _org.joda.DateTime: http://joda-time.sourceforge.net/

.. _datetime.datetime: http://docs.python.org/library/datetime.html

.. _Pyxb: http://pyxb.sourceforge.net/api/pyxb.binding.datatypes.dateTime-class.html



..                                    ######
.. class:: DescribeResponse  

  The :func:`MNRead.describe` method provides a low cost hint about the type,
  size and state of an object.

  The *DescribeResponse* is returned from the server in a HTTP HEAD response,
  and hence the values must be represented in the HTTP response headers. There
  is no XML serialization of a *DescribeResponse*.

  .. image:: images/class_describeresponse.png

  ..
    @startuml images/class_describeresponse.png
    class DescribeResponse {
      +DataONE-fmtid : ObjectFormatIdentifier
      +Content-Length : integer
      +Last-Modified : DateTime
      +DataONE-Checksum : Checksum
    }
    DescribeResponse -- ObjectFormatIdentifier
    DescribeResponse -- Checksum
    DescribeResponse -- DateTime
    @enduml

  .. attribute:: DataONE-fmtid

     The value of the :attr:`SystemMetadata.fmtid` entry available in the
     :class:`SystemMetadata`.

  .. attribute:: Content-Length

     Size of the object in bytes, the value of :attr:`SystemMetadata.size`
     from :class:`SystemMetadata`.

  .. attribute:: Last-Modified

     A :class:`DateTime` value that indicates when the :term:`system metadata`
     associated with the object was last modified, i.e. the value of
     :attr:`SystemMetadata.dateSysMetadataModified` for the object.

  .. attribute:: DataONE-Checksum

     The ChecksumAlgorithm and Checksum value of the object being examined.
     The algorithm and checksum values are separated by a single comma with
     the algorithm first.


  Example of a HEAD response on object "ABC123"::

    curl -I http://mn1.dataone.org/mn/object/ABC123

    HTTP/1.1 200 OK
    Last-Modified: Wed, 16 Dec 2009 13:58:34 GMT
    Content-Length: 10400
    Content-Type: application/octet-stream
    DataONE-fmtid: eml://ecoinformatics.org/eml-2.0.1
    DataONE-Checksum: SHA-1,2e01e17467891f7c933dbaa00e1459d23db3fe4f



..                                    ######
.. include:: types_errors.txt



..                                    ######
.. class:: Event

  The controlled list of events that are logged, which will include 'CREATE',
  'UPDATE', 'DELETE', 'READ', 'REPLICATE' events

  .. image:: images/class_event.png

  ..
    @startuml images/class_event.png
    enum Event
    Event : CREATE
    Event : READ
    Event : UPDATE
    Event : DELETE
    Event : REPLICATE
    Event : CHANGEOWNER
    @enduml

  As represented in XML Schema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Event Enumeration -->
     :end-before: <!-- Node State -->



..                                    ######
.. class:: Group

  Group represents metadata about a Subject that is a group of other Subjects
  and that can be used by clients and nodes for displaying AccessPolicy
  information.

  .. attribute:: Subject

     The unique identifier of the group.

  .. attribute:: GroupName

     The name of the Group.

  .. attribute:: hasMember

     A Subject that is a member of this group, expressed using the
     unique identifier for that Subject.

  As represented in XML Schema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Group -->
     :end-before: <!-- Identifier  -->

  .. image:: images/class_group.png

  .. 
     @startuml images/class_group.png
     class Group {
       + subject : Subject
       + groupName : NonEmptyString
       + hasMember : Subject[0..*]
     }
     Group o-- Subject
     Group -- NonEmptyString
     @enduml



..                                    ######
.. class:: PingResponse

  The response from :func:`MNCore.ping` which is a HTTP response with status
  code 200 and arbitrary, preferably empty payload (ignored by the caller).



..                                    ######
.. class:: StatusResponse

  The response from :func:`MNCore.getStatus`. This is currently (2011-05-24)
  undefined. This operation *may* replace ping() on closer evaluation of the
  design notes.



..                                    ######
.. class:: IdentifierFormat

  Initially an enumerated list of strings that specify different types of identifiers.

  As represented in XML Schema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Identifier Format enumeration -->
     :end-before: <!-- Service Name -->

  .. image:: images/class_identifierformat.png

  ..
    @startuml images/class_identifierformat.png
    enum IdentifierFormat
    IdentifierFormat : OID
    IdentifierFormat : LSID
    IdentifierFormat : UUID
    IdentifierFormat : LSRN
    IdentifierFormat : DOI
    IdentifierFormat : URI
    IdentifierFormat : STRING
    @enduml



..                                    ######
.. class:: Identifier

  An :term:`identifier` (:term:`PID`) in the DataONE system. This is equivalent
  to a Unicode string of printable characters, excluding whitespace. All
  representations of identifiers must be encoded in 7-bit ASCII or UTF-8.

  Identifiers have a maximum length of 800 characters. Some discussion on this
  is described in `ticket 577`_.

  As represented in XML Schema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Identifier  -->
     :end-before: <!--  Log -->

  .. image:: images/class_identifier.png

  ..
     @startuml images/class_identifier.png
     NonEmptyString <|-- Identifier
     @enduml


.. _ticket 577: https://redmine.dataone.org/issues/577



..                                    ######
.. class:: LogEntry

  A single log entry as reported by a Member Node or Coordinating Node through
  the :func:`MNCore.getLogRecords` and :func:`CNCore.getLogRecords` methods.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
       :language: xml
       :start-after: <!-- Log Entry -->
       :end-before: <!-- Monitor Info -->

  .. image:: images/class_logentry.png

  .. 
    @startuml images/class_logentry.png
    class LogEntry {
      + entryID : Identifier
      + identifier : Identifier
      + ipAddress : string
      + userAgent : string
      + subject : Subject
      + event : Event
      + dateLogged : DateTime
      + memberNode : NodeReference
    }
    LogEntry -- Identifier
    LogEntry -- Subject
    LogEntry -- Event
    LogEntry -- DateTime
    LogEntry -- NodeReference
    @enduml



..                                    ######
.. class:: Log

  Represents a collection of LogEntry elements, used to transfer log information
  between DataONE components.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!--  Log -->
     :end-before: <!-- Log Entry -->

  .. image:: images/class_log.png

  .. 
    @startuml images/class_log.png
    class Log {
      + start : integer
      + count : integer
      + total : integer
      + logEntry : LogEntry[0..*]
    }
    Log o-- LogEntry
    @enduml

  .. attribute:: start

     The zero based index of the first logEntry in the list relative to the
     first available.

  .. attribute:: count

     The number of logEntry values present in the message.

  .. attribute:: total

     The total number of logEntry values available on the server.

  .. attribute:: logEntry

     A list of zero or more instances of :class:`Types.LogEntry`.



..                                    ######
.. class:: MonitorList

  A list of MonitorInfo instances.

  ::

    message MonitorList {
      repeated LogRecord entry = 0;
    }



..                                    ######
.. class:: MonitorInfo

  A single log entry as reported by a Member Node or Coordinating Node through
  the getMonitorInfos methods.

  :: 

    message MonitorInfo {
      required DateTime time = 0;
      required uint64 size = 1;
    }



..                                    ######
.. class:: Node

  A set of values that describe a node, its Internet location, the services it
  supports and its replication policy.

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Node -->
     :end-before: <!-- Node Health -->

  .. image:: images/class_node.png

  ..
    @startuml images/class_node.png
    class Node {
      identifier : NodeReference
      name : NonEmptyString
      description : NonEmptyString
      baseURL : anyURI
      services : Services[0..1]
      synchronization : Synchronization[0..1]
      health : Nodehealth[0..1]
      subject: Subject[0..*]
      replicate : boolean
      synchronize : boolean
      type : NodeType
    }
    Node -- NodeReference
    Node -- NonEmptyString
    Node o-- Services
    Node o-- Synchronization
    Node o-- NodeHealth
    Node -- NodeType
    @enduml



..                                    ######
.. class:: NodeHealth

   NodeHealth is used to record the current operating status of the node. 
   Operating status is determined by the Coordinating Nodes and is influenced by
   the results of polling ping() and getCapabilities(), by a node 
   calling updateNodeCapabilities(), and through periodic checks of service
   compliance.

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Node Health -->
     :end-before: <!-- Node List -->

  .. image:: images/class_nodehealth.png

  ..
    @startuml images/class_nodehealth.png
    class NodeHealth {
      ping : Ping
      status : Status
    }
    NodeHealth -- Ping
    NodeHealth -- Status
    @enduml



..                                    ######
.. class:: NodeList

  A list of Node entries that is returned by :func:`CNCore.listNodes()`.

  NodeList is described in :mod:`NodeList`.


  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Node List -->
     :end-before: <!-- Object Format -->

  .. image:: images/class_nodelist.png

  ..
    @startuml images/class_nodelist.png
    class NodeList {
      node : Node[1..*]
    }
    NodeList o-- Node
    @enduml



..                                    ######
.. class:: NodeReference

  Member Node identifier drawn from the DataONE :mod:`CNRegister <registry service>`.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- NodeReference -->
     :end-before: <!-- Object Format -->

  .. image:: images/class_nodereference.png

  .. 
    @startuml images/class_nodereference.png
    NonEmptyString <|-- NodeReference
    @enduml



..                                    ######
.. class:: NodeType

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Node Type Enumeration -->
     :end-before: <!-- Non-Empty String -->

  .. image:: images/class_nodetype.png

  .. 
    @startuml images/class_nodetype.png
    enum NodeType
    NodeType : cn 
    NodeType : mn
    NodeType : Monitor
    @enduml



..                                    ######
.. class:: ObjectFormatIdentifier

  A string used to identify an instance of :class:`Types.ObjectFormat` and MUST
  be unique within an instance of :class:`Types.ObjectFormatList`.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Object Format Identifier -->
     :end-before: <!-- NonEmptyString800

  .. image:: images/class_objectformatidentifier.png
  
  ..
    @startuml images/class_objectformatidentifier.png
    NonEmptyString <|-- ObjectFormatIdentifier
    @enduml



..                                    ######
.. class:: ObjectFormat

  One value from the DataONE Object Format Vocabulary, which is returned by :func:`CNCore.getFormat()`.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Object Format -->
     :end-before: <!--  Object Format List -->
  
  .. attribute:: identifier
    
     Unique identifier representing the object format.
     
  .. attribute:: formatName
  
     A human readable name that describes the object format

  .. attribute:: scienceMetadata

    A boolean value indicating if the object format should be treated as science 
    metadata and processed accordingly.

  .. image:: images/class_objectformat.png

  ..
    @startuml images/class_objectformat.png
    class ObjectFormat {
      fmtid : ObjectFormatIdentifier
      formatName : string
      scienceMetadata: boolean
    }
    ObjectFormat -- ObjectFormatIdentifier
    @enduml



..                                    ######
.. class:: ObjectFormatList

  A list of ObjectFormat entries that is returned by :func:`CNCore.listFormats()`.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!--  Object Format List -->
     :end-before: <!-- Object Info -->
  
  ::

    message ObjectFormatList
    {
      required int start = 0;
      required int count = 1;
      required int total = 2;
      repeated ObjectFormat objectFormat = 3;
    }

  .. attribute:: start

     An integer that indicates zero-based offset of the first entry in
     objectFormat from the start of the list of entries from which this 
     list was drawn (such as the results of :func:`CNCore.listFormats`)

  .. attribute:: count

     The total number of entries returned in :attr:`objectFormat`.

  .. attribute:: total

     The total number of entries in the list from which this list was drawn.

  .. attribute:: objectFormat

     The ObjectFormat structure for each object format listed.

   .. image:: images/class_objectformatlist.png

   ..
     @startuml images/class_objectformatlist.png
     class ObjectFormatList {
       start : integer
       count : integer
       total : integer
       objectFormat : ObjectFormat[1..*]
     }
     ObjectFormatList o-- ObjectFormat
     @enduml


..                                    ######
.. class:: ObjectList

  A list of :class:`ObjectInfo` structures.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Object Info -->
     :end-before: <!-- Object Location -->
 
  .. image:: images/class_objectlist.png

  .. 
    @startuml images/class_objectlist.png
    class ObjectInfo {
      + identifier : Identifier
    }
    ObjectInfo -- Identifier
    DescribeResponse <|-- ObjectInfo
    
    class Slice {
      + count: integer
      + start: integer
      + total: integer
    }
    
    class ObjectList {
      objectInfo : ObjectInfo[0..*]
    }
    ObjectList o-- ObjectInfo
    Slice <|-- ObjectList
    @enduml

  .. attribute:: identifier

     Identifier of the object in the describe response.

  .. attribute:: start

     An integer that indicates zero-based offset of the first entry in
     objectInfo from the start of the list of entries from which this list was
     drawn (such as the results of :func:`CNRead.search` or
     :func:`MNRead.listObjects`)

  .. attribute:: count

     The total number of entries returned in :attr:`objectInfo`.

  .. attribute:: total

     The total number of entries in the list from which this list was drawn.

  .. attribute:: objectInfo

     List of ObjectInfo structures, which are an extension of :class:`DescribeResponse`



..                                    ######
.. class:: ObjectLocationList

   A list of nodes and node service base URLs known to hold a copy of an
   object, returned by :func:`CNRead.resolve`.

   As represented in XMLSchema:

   .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
      :language: xml
      :start-after: <!-- Object Location List -->
      :end-before: <!-- Person -->

  .. attribute:: identifier

     The identifier that this ObjectLocationList refers to (e.g. the identifier
     for the science metadata or data object).

  .. attribute:: locations

     List of ``ObjectLocation`` entries that indicate the nodes on which the
     object is located.

  .. image:: images/class_objectlocationlist.png

  ..
    @startuml images/class_objectlocationlist.png
      class ObjectLocationList {
        + identifier : Identifier
        + locations : ObjectLocation[0..*]
      }
      ObjectLocationList o-- ObjectLocation
      ObjectLocationList -- Identifier
    @enduml



..                                    ######
.. class:: ObjectLocation

   Portion of an ObjectLocationList indicating the node from which the object
   can be retrieved. 

   As represented in XMLSchema:

   .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
      :language: xml
      :start-after: <!-- Object Location -->
      :end-before: <!-- Object Location List -->

  .. attribute:: nodeIdentifier

     A node identifier. Node identifiers follow the same composition rules as
     other identifiers in the system and no meaning should be implied from the
     construct other than as a unique identifier for the node.

  .. attribute:: baseURL

     The current base URL for services implemented on the target node. For example:
     ``http://mn1.dataone.org/mn/``

  .. attribute:: url

    The full URL for retrieving the object bytes. For example, if identifer
    was "ABX154", and the node had a base URL of ``http://mn1.dataone.org/mn``
    then the value would be ``http://mn1.dataone.org/mn/object/ABX154``

  .. attribute:: preference

     A weighting parameter that provides a hint to the caller for the relative
     preference for nodes from which the content should be retrieved. Higher
     values have higher preference. Values are only relative to each other in
     a particular response. Nodes with equal weight get equal values.

  .. image:: images/class_objectlocation.png

  .. 
    @startuml images/class_objectlocation.png
    class ObjectLocation {
      + nodeIdentifier : NodeReference
      + baseURL : anyURI
      + url : anyURI
      + preference : integer[0..1]
    }
    ObjectLocation -- NodeReference
    @enduml



..                                    ######
.. class:: Permission

  A string value indicating the set of actions that can be performed on a
  resource as specified in an access policy. The set of permissions include the
  ability to read a resource, modify a resource (write), and to change the set
  of access control policies for a resource (changePermission). In addition,
  there is a permission that controls ability to execute a service (execute).
  Permissions are cumulative, in that higher level permissions include all of
  the privileges of lower levels (e.g., given write access, one also implicitly
  has read access).

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Permission
     :end-before: <!-- QueryType

  .. image:: images/class_permission.png

  .. 
    @startuml images/class_permission.png
    enum Permission
    Permission : READ
    Permission : WRITE
    Permission : CHANGEPERMISSION
    Permission : EXECUTE
    @enduml



..                                    ######
.. class:: Person

  Person represents metadata about a Principal that is a person and that 
  can be used by clients and nodes for displaying AccessPolicy information.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Person -->
     :end-before: <!-- Ping -->

  .. attribute:: subject

     The unique identifier for the person.

  .. attribute:: givenName

     The given name of the Person.

  .. attribute:: familyName

     The family name of the Person.

  .. attribute:: email

     The email address of the Person.

  .. attribute:: isMemberOf

     A group or role in which the Principal is a member, expressed using the
     unique Principal identifier for that group.

  .. attribute:: equivalentIdentity

     An alternative but equivalent identity for the principal that has been
     used in alternate identity systems.

  .. image:: images/class_person.png

  ..
    @startuml images/class_person.png
    class Person {
      + subject : Subject
      + givenName : NonEmptyString
      + familyName : NonEmptyString
      + email : NonEmptyString
      + isMemberOf : Subject
      + equivalentIdentity : Subject[0..*]
    }
    Person o-- Subject
    Person -- NonEmptyString
    @enduml



..                                    ######
.. class:: PingResponse

  The response from :func:`MNCore.ping`




..                                    ######
.. class:: RelationshipEnum

   An enumeration of relationship types that correspond with different
   inter-object relationships expressed in the System Metadata. Used as a
   parameter in :func:`CNRead.assertRelation`.

   .. image:: images/class_relationshipenum.png

   ..
    @startuml images/class_relationshipenum.png
    enum RelationshipEnum
    RelationshipEnum : DESCRIBES
    RelationshipEnum : DESCRIBED_BY
    RelationshipEnum : OBSOLETES
    RelationshipEnum : OBSOLETED_BY
    RelationshipEnum : DERIVED_FROM
    @enduml



..                                    ######
.. class:: Replica

   Replica information that forms a part of the SystemMetadata.

   As represented in XMLSchema:

   .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
      :language: xml
      :start-after: <!-- Replica -->
      :end-before: <!-- Replication Policy -->

  .. image:: images/class_replica.png

  ..
    @startuml images/class_replica.png
    class Replica {
      + replicaMemberNode : NodeReference
      + replicationStatus : ReplicationStatus
      + replicaVerified : DateTime
    }
    Replica -- NodeReference
    Replica -- ReplicationStatus
    Replica -- DateTime
    @enduml



..                                    ######
.. class:: ReplicationStatus

   Defines the replication policy applied to a particular object.

   As represented in XMLSchema:

   .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
      :language: xml
      :start-after: <!-- Replication Status enumeration -->
      :end-before: <!-- Identifier Format enumeration -->

  .. image:: images/class_replicationstatus.png

  ..
    @startuml images/class_replicationstatus.png
    enum ReplicationStatus
      ReplicationStatus : queued
      ReplicationStatus : requested
      ReplicationStatus : completed
      ReplicationStatus : invalidated
    @enduml



..                                    ######
.. class:: ReplicationPolicy

   Defines the replication policy applied to a particular object.

   As represented in XMLSchema:

   .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
      :language: xml
      :start-after: <!-- Replication Policy -->
      :end-before: <!-- Service -->

  .. image:: images/class_replicationpolicy.png

  ..
    @startuml images/class_replicationpolicy.png
    class ReplicationPolicy {
      + preferredMemberNode : NodeReference[0..*]
      + blockedMemberNode : NodeReference[0..*]
      + replicationAllowed : Boolean
      + numberReplicas : Integer
    }
    ReplicationPolicy -- NodeReference
    @enduml



..                                    ######
.. class:: Schedule

  As represented in XMLSchema:
  
  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
    :language: xml
    :start-after: <!-- Schedule -->
    :end-before: <!-- Slice -->
  
  .. image:: images/class_schedule.png
  
  ..
    @startuml images/class_schedule.png
    class Schedule {
      + hour : CrontabEntry
      + mday : CrontabEntry
      + min : CrontabEntry
      + mon : CrontabEntry
      + sec : CrontabEntry
      + wday : CrontabEntry
      + year : CrontabEntry
    }
    Schedule -- CrontabEntry
    @enduml



..                                    ######
.. class:: Service

  As represented in XMLSchema:
  
  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
    :language: xml
    :start-after: <!-- Service -->
    :end-before: <!-- Service Method
  
  .. image:: images/class_service.png
  
  ..
    @startuml images/class_service.png
    class Service {
      + name : ServiceName
      + method : ServiceMethod[0..*]
      + version : ServiceVersion
      + available : Boolean
    }
    Service -- ServiceName
    Service o-- ServiceMethod
    Service -- ServiceVersion
    @enduml



..                                    ######
.. class:: ServiceMethod

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Service Method
     :end-before: <!-- Services -->

  .. image:: images/class_servicemethod.png

  ..
    @startuml images/class_servicemethod.png
    class ServiceMethod {
      + name : NMTOKEN
      + rest : token
      + implemented : Boolean
    }
    @enduml



..                                    ######
.. class:: ServiceName

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Service Name -->
     :end-before: <!-- Service Version -->

  .. image:: images/class_servicename.png

  ..
    @startuml images/class_servicename.png
    NonEmptyString <|-- ServiceName
    @enduml



..                                    ######
.. class:: Services

  As represented in XMLSchema:
  
  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
    :language: xml
    :start-after: <!-- Services -->
    :end-before: <!-- Session -->
  
  .. image:: images/class_services.png
  
  ..
    @startuml images/class_services.png
    class Services {
      + service : Service[1..*]
    }
    Services o-- Service
    @enduml



..                                    ######
.. class:: ServiceVersion

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Service Version -->
     :end-before: <!-- ***************************************

  .. image:: images/class_serviceversion.png

  ..
    @startuml images/class_serviceversion.png
    NonEmptyString <|-- ServiceVersion
    @enduml



..                                    ######
.. class:: Subject

  Person (user), Group, or Organization, or System.

  The formal name identifying a user or group from the DataONE Identity
  Management Service. The subject is represented by a unique, persistent,
  non-reassignable identifier string that follows the same constraints as the
  Identifier.

  Used by :mod:`SystemMetadata`

  As represented in XMLSchema:
  
  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Subject =
     :end-before: <!-- SubjectList -->

  .. image:: images/class_subject.png

  ..
    @startuml images/class_subject.png
    NonEmptyString <|-- Subject
    @enduml



..                                    ######
.. class:: SubjectList

  A List of Subjects, including both persons and groups, that is returned
  from the listSubjects service.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- SubjectList -->
     :end-before: <!-- Definition of the SystemMetdata element -->

  .. image:: images/class_subjectlist.png

  ..
    @startuml images/class_subjectlist.png
    class SubjectList {
      + person : Person[0..*]
      + group : Group[0..*]
    }
    SubjectList o-- Person
    SubjectList o-- Group
    @enduml



..
  ######
  .. class:: SuccessFlag

     A boolean value typically used to return a positive response from operations
     that indicate success or failure of the operation through a boolean response.

     As represented in XMLSchema:

     .. LiteralInclude:: /d1_schemas_v1/dataoneTypes.xsd
        :language: xml
        :start-after: <!-- SuccessFlag -->
        :end-before: <!-- *********

     .. image:: images/class_successflag.png

     .. 
       @startuml images/class_successflag.png
       class SuccessFlag {
         + value : boolean
       }
       @enduml



..                                    ######
.. class:: Synchronization

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
    :language: xml
    :start-after: <!-- Synchronization -->
    :end-before: <!-- Subject =
  
  .. image:: images/class_synchronization.png

  ..
    @startuml images/class_synchronization.png
    class Synchronization {
      + schedule : Schedule
      + lastHarvested : DateTime
      + lastCompleteHarvest : DateTime
    }
    Synchronization -- Schedule
    Synchronization -- DateTime
    @enduml



..                                    ######
.. class:: Query

   Queries are used to identify a subset of objects from a collection. The
   form of query used by the DataONE system is likely to evolve significantly
   as the project proceeds. The query specification listed here applies to the
   prototype implementations (i.e. pre-version 1.0).

   ::
    
     enum FilterTypeEnum 
     {
       NVP = 1;
       SOLR = 3;
       EARTHGRID = 4;
     }
     
     enum LogicalOperator
     {
       LOP_OR = 0;
       LOP_AND = 1;
     }

     message NameValuePair
     {
       required string name = 0;
       required string value= 1;
     }

     message NameValuePairFilter
     {
       optional LogicalOperator LOP = 1 [default = LOP_AND];
       repeated NameValuePair nvpair = 2;
     }

     message SOLRFilter
     {
       required string filter = 0;
       optional string facetFilter = 1;
     }

     message EarthGridFilter
     {
       required string filter = 0;
     }



..                                    ######
.. class:: Session

  Information about the authenticated session for a service transaction.
  Session data is retrieved from the SSL client certificate and populated in
  the Session object. The subject represents the person or system that
  authenticated successfully, and the subjectList contains a listing of
  alternate identities (both Persons and Groups) that are also valid
  identities for this user. The subjectList should include at least one Person
  or Group entry that provides the attributes of the subject that was
  authenticated.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Session -->
     :end-before: <!-- Schedule -->

  .. image:: images/class_session.png

  ..
    @startuml images/class_session.png
    class Session {
      + subject : Subject
      + subjectList : SubjectList[0..1]
    }
    Session o-- Subject
    Session o-- SubjectList
    @enduml



..                                    ######
.. class:: Status

  The response from :func:`MNCore.getStatus`



..                                    ######
.. class:: SystemMetadata

  A set of low level information about an object in the DataONE system.
  SystemMetadata is described in :mod:`SystemMetadata`.

  As represented in XMLSchema:

  .. LiteralInclude::   /d1_schemas_v1/dataoneTypes.xsd
     :language: xml
     :start-after: <!-- Definition of the SystemMetdata element -->
     :end-before:  <!-- ***

  .. image:: images/class_systemmetadata.png

  ..
    @startuml images/class_systemmetadata.png
    class SystemMetadata {
      + identifier : Identifier
      + fmtid : ObjectFormatIdentifier
      + size : long
      + checksum : Checksum
      + submitter : Subject
      + rightsHolder : Subject
      + accessPolicy : AccessPolicy[0..*]
      + replicationPolicy : ReplicationPolicy[0..*]
      + obsoletes : Identifier[0..*]
      + obsoletedBy : Identifier[0..*]
      + resourceMap : Identifier[0..*]
      + dateUploaded : dateTime
      + dateSysMetadataModified : dateTime
      + originMemberNode : NodeReference
      + authoritativeMemberNode : NodeReference
      + replica : Replica[0...*]
    }
    SystemMetadata o-- Identifier
    SystemMetadata -- ObjectFormatIdentifier
    SystemMetadata -- Subject
    SystemMetadata o-- AccessPolicy
    SystemMetadata o-- ReplicationPolicy
    SystemMetadata -- Checksum
    SystemMetadata -- NodeReference
    SystemMetadata o-- Replica
    @enduml



.. class:: X509Certificate

   Deprecated. See :class:`Types.Session`



.. _Protocol Buffer Language: http://code.google.com/apis/protocolbuffers/docs/overview.html

