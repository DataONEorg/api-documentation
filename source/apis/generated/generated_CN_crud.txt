..
  Warning: this file is automatically generated.  Edits will be lost


.. list-table:: Functions defined in :mod:`CN_crud`
   :widths: 10 10 30
   :header-rows: 1

   * - REST
     - Function
     - Parameters
   * - :ref:`CN_crud.get`
     - :func:`get`
     - (:class:`token<Types.AuthToken>`, :class:`pid<Types.Identifier>`) ``->``
       bytes
   * - :ref:`CN_crud.getSystemMetadata`
     - :func:`getSystemMetadata`
     - (:class:`token<Types.AuthToken>`, :class:`pid<Types.Identifier>`) ``->``
       :class:`Types.SystemMetadata`
   * - :ref:`CN_crud.resolve`
     - :func:`resolve`
     - (:class:`token<Types.AuthToken>`, :class:`pid<Types.Identifier>`) ``->``
       :class:`Types.ObjectLocationList`
   * - n/a
     - :func:`create`
     - (:class:`pid<Types.Identifier>`,
       :class:`systemMetadata<Types.SystemMetadata>`, ``scienceMetadata``)
       ``->`` boolean
   * - :ref:`CN_crud.reserveIdentifier`
     - :func:`reserveIdentifier`
     - (:class:`token<Types.AuthToken>`, :class:`[pid]<Types.Identifier>`,
       ``[scope]``, ``[format]``) ``->`` :class:`Types.Identifier`
   * - :ref:`CN_crud.assertRelation`
     - :func:`assertRelation`
     - (:class:`token<Types.AuthToken>`,
       :class:`pidOfSubject<Types.Identifier>`,
       :class:`relationship<Types.???>`, :class:`pidOfObject<Types.Identifier>`)
       ``->`` boolean
   * - n/a
     - :func:`log`
     - (:class:`typeOfOperation<Types.Event>`,
       :class:`targetPid<Types.Identifier>`,
       :class:`requestorIdentitity<Types.Principal>`,
       :class:`dateOfRequest<Types.DateTime>`) ``->``
   * - n/a
     - :func:`getChecksum`
     - (:class:`token<Types.AuthToken>`, :class:`pid<Types.Identifier>`) ``->``
       :class:`Types.Checksum`




.. function:: get(token,pid) -> bytes

   Retrieves the object identified by *pid* from the node. If the object is not
   present on the node, then an :exc:`Exceptions.NotFound` error is raised
   (regardless of whether the object exists on another node in the DataONE
   system).

   :Use Cases:

     :doc:`UC01 </design/UseCases/01_uc>`, :doc:`UC16 </design/UseCases/16_uc>`,
     :doc:`UC09 </design/UseCases/09_uc>`

   :REST URL: MN :ref:`CN_crud.get`

   :param token: The authentication token returned by
     :func:`CN_authentication.login`

   :type token: :class:`Types.AuthToken`

   :param pid: Identifier of the object to be retrieved

   :type pid: :class:`Types.Identifier`

   :returns: For science metadata objects, this will be the exact byte stream of
     the science metadata object as it was original ingested. Note that
     additional object types may in the future be returned by the get method.

   :rtype: bytes

   :raises Exceptions.NotAuthorized: ``(errorCode=401, detailCode=1000)``

   :raises Exceptions.NotImplemented: ``(errorCode=501, detailCode=1001)``

   :raises Exceptions.NotFound: ``(errorCode=404, detailCode=1020)``

     The object specified by the identifier is not present on this (or any) CN.
     The response body should contain a reference to :func:`CN_crud.resolve`.


   :raises Exceptions.ServiceFailure: ``(errorCode=500, detailCode=1030)``

   :raises Exceptions.InvalidToken: ``(errorCode=401, detailCode=1010)``

   :raises Exceptions.InvalidRequest: ``(errorCode=400, detailCode=1002)``




.. function:: getSystemMetadata(token,pid) -> SystemMetadata

   Returns the :term:`system metadata` that contains DataONE specific
   information about the object identified by *pid*. Note that authoritative
   copies of system metadata are only available from the Coordinating Nodes.

   :Use Cases:

     :doc:`UC36 </design/UseCases/36_uc>`, :doc:`UC37 </design/UseCases/37_uc>`,
     :doc:`UC16 </design/UseCases/16_uc>`

   :REST URL: MN :ref:`CN_crud.getSystemMetadata`

   :param token: The authentication token returned by
     :func:`CN_authentication.login`

   :type token: :class:`Types.AuthToken`

   :param pid: Identifier for the object of interest.

   :type pid: :class:`Types.Identifier`

   :returns: A system metadata document describing the object.

   :rtype: :class:`Types.SystemMetadata`

   :raises Exceptions.InvalidToken: ``(errorCode=401, detailCode=1050)``

   :raises Exceptions.NotImplemented: ``(errorCode=501, detailCode=1041)``

   :raises Exceptions.ServiceFailure: ``(errorCode=500, detailCode=1090)``

   :raises Exceptions.NotAuthorized: ``(errorCode=401, detailCode=1040)``

     The principal identified by token does not have READ permission on the
     object.


   :raises Exceptions.NotFound: ``(errorCode=404, detailCode=1060)``

     There is no object identified by *pid* and so no system metadata can be
     returned.


   :raises Exceptions.InvalidRequest: ``(errorCode=400, detailCode=1080)``




.. function:: resolve(token,pid) -> ObjectLocationList

   Given an identifier, returns information that a client can use to retrieve
   the identified target object from the DataONE system. The target may reside
   on a MN or a CN.

   :Use Cases:

     :doc:`UC36 </design/UseCases/36_uc>`, :doc:`UC16 </design/UseCases/16_uc>`

   :REST URL: MN :ref:`CN_crud.resolve`

   :param token: The authentication token returned by
     :func:`CN_authentication.login`

   :type token: :class:`Types.AuthToken`

   :param pid: Identifier for the object of interest.

   :type pid: :class:`Types.Identifier`

   :returns: A list of nodes known to contain copies of the target object, plus
     the URLs known to resolve to the node get methods.

   :rtype: :class:`Types.ObjectLocationList`

   :raises Exceptions.InvalidToken: ``(errorCode=401, detailCode=4130)``

   :raises Exceptions.ServiceFailure: ``(errorCode=500, detailCode=4150)``

   :raises Exceptions.NotAuthorized: ``(errorCode=401, detailCode=4120)``

   :raises Exceptions.NotFound: ``(errorCode=404, detailCode=4140)``

     There is no object identified by the given identifier


   :raises Exceptions.NotImplemented: ``(errorCode=501, detailCode=4131)``

   :raises Exceptions.InvalidRequest: ``(errorCode=400, detailCode=4132)``




.. function:: create(pid,systemMetadata,scienceMetadata) -> boolean

   This is a method used internally by the CN, not exposed to MNs or the world.
   Stores the two given objects (system metadata, science metadata) in a single
   atomic action. The science metadata document is optional as *pid* may refer
   to science data which is not retrieved to the Coordinating Node. This method
   is used as part of the :term:`Member Node synchronization` of science
   metadata between a MN and a CN.

   :Use Cases:

     :doc:`UC06 </design/UseCases/06_uc>`, :doc:`UC16 </design/UseCases/16_uc>`

   :REST URL: N/A

   :param pid: Identifier of the object being registered

   :type pid: :class:`Types.Identifier`

   :param systemMetadata: System metadata generated by the Member Node (and ITK
     client) describing the object.

   :type systemMetadata: :class:`Types.SystemMetadata`

   :param scienceMetadata: The science metadata referenced by *pid*.

   :type scienceMetadata: bytes

   :returns: Acknowledgement of success or failure

   :rtype: boolean

   :raises Exceptions.ServiceFailure: ``(errorCode=500, detailCode=4115)``

   :raises Exceptions.UnsupportedMetadataType: ``(errorCode=400, detailCode=4100)``

     The science metadata is not of a type supported by the system


   :raises Exceptions.IdentifierNotUnique: ``(errorCode=409, detailCode=4110)``

     This should never be raised, but is required asa sanity check on the object
     store


   :raises Exceptions.NotImplemented: ``(errorCode=501, detailCode=4101)``

   :raises Exceptions.InvalidRequest: ``(errorCode=400, detailCode=4102)``




.. function:: reserveIdentifier(token,[pid],[scope],[format]) -> Identifier

   Given an optional scope and format, reserves and returns an identifier within
   that scope and format that is unique and will not be used by any other
   sessions. Future calls to :func:`MN_crud.create` and :func:`MN_crud.update`
   that reference this ID must originate from the :term:`session` in which the
   identifier was reserved, otherwise an error is raised on those methods.

   :Use Cases:

     :doc:`UC16 </design/UseCases/16_uc>`

   :REST URL: MN :ref:`CN_crud.reserveIdentifier`

   :param token: The authentication token returned by
     :func:`CN_authentication.login`

   :type token: :class:`Types.AuthToken`

   :param pid: An optional identifier proposed by the client. If no identifier
     is provided then one will be automatically generated.

   :type pid: :class:`Types.Identifier`

   :param scope: An optional string to be used to qualify the scope of the
     identifier namespace, which is applied differently depending on the format
     requested. If scope is not supplied, a default scope will be used.

   :type scope: string

   :param format: The optional name of the identifier format to be used, drawn
     from a DataONE-specific vocabulary of identifier format names, including
     several common syntaxes such as DOI, LSID, UUID, and LSRN, among others. If
     the format is not supplied by the caller, the CN service will use a default
     identifier format, which may change over time.

   :type format: string

   :returns: The identifier that was reserved

   :rtype: :class:`Types.Identifier`

   :raises Exceptions.InvalidToken: ``(errorCode=401, detailCode=4190)``

   :raises Exceptions.ServiceFailure: ``(errorCode=500, detailCode=4210)``

   :raises Exceptions.NotAuthorized: ``(errorCode=401, detailCode=4180)``

     Supplied credentials does not have WRITE permission


   :raises Exceptions.InvalidRequest: ``(errorCode=400, detailCode=4200)``

     The format requested is not a valid format accepted by this service


   :raises Exceptions.IdentifierNotUnique: ``(errorCode=409, detailCode=4210)``

     The requested identifier can not be reserved because it already exists in
     the DataONE system or has already been reserved.


   :raises Exceptions.NotImplemented: ``(errorCode=501, detailCode=4191)``




.. function:: assertRelation(token,pidOfSubject,relationship,pidOfObject) -> boolean

   Tests that the specified relationship between *pidOfSubject* and
   *pidOfObject* exists.

   :REST URL: MN :ref:`CN_crud.assertRelation`

   :param token: The authentication token returned by
     :func:`CN_authentication.login`

   :type token: :class:`Types.AuthToken`

   :param pidOfSubject: The subject of the relationship being tested

   :type pidOfSubject: :class:`Types.Identifier`

   :param relationship: Relationship between *pidOfSubject* and *pidOfObject*
     being evaluated

   :type relationship: ???

   :param pidOfObject: The object of the relationship

   :type pidOfObject: :class:`Types.Identifier`

   :returns: True or False

   :rtype: boolean

   :raises Exceptions.InvalidToken: ``(errorCode=401, detailCode=4230)``

   :raises Exceptions.ServiceFailure: ``(errorCode=500, detailCode=4270)``

   :raises Exceptions.NotAuthorized: ``(errorCode=401, detailCode=4220)``

   :raises Exceptions.NotFound: ``(errorCode=404, detailCode=4240)``

   :raises Exceptions.InvalidRequest: ``(errorCode=400, detailCode=4260)``

     Raised if the parameters are incorrect (e.g. unknown relationship type
     specified)


   :raises Exceptions.NotImplemented: ``(errorCode=501, detailCode=4221)``

.. TODO::
    Define what is meant by relationship - what is the type for this?




.. function:: log(typeOfOperation,targetPid,requestorIdentitity,dateOfRequest) -> 

   This method is used exclusively internally by a CN. It really isn't part of
   external the API that must be implemented. However, a CN will need to
   implement some sort of logging infrastructure so that it can respond to
   :func:`CN_crud.getLogRecords()`.

   :Use Cases:

     :doc:`UC01 </design/UseCases/01_uc>`, :doc:`UC02 </design/UseCases/02_uc>`,
     :doc:`UC06 </design/UseCases/06_uc>`, :doc:`UC16 </design/UseCases/16_uc>`,
     :doc:`UC09 </design/UseCases/09_uc>`

   :REST URL: N/A

   :param typeOfOperation: Enumerated value

   :type typeOfOperation: :class:`Types.Event`

   :param targetPid: The target of the operation

   :type targetPid: :class:`Types.Identifier`

   :param requestorIdentitity: Who invoked the operation

   :type requestorIdentitity: :class:`Types.Principal`

   :param dateOfRequest: Time stamp

   :type dateOfRequest: :class:`Types.DateTime`

   :returns:

   :rtype: 

   :raises Exceptions.InvalidRequest: ``(errorCode=400, detailCode=1500)``

     Define the type of the Log Event


   :raises Exceptions.ServiceFailure: ``(errorCode=500, detailCode=1510)``

   :raises Exceptions.NotImplemented: ``(errorCode=501, detailCode=1501)``




.. function:: getChecksum(token,pid) -> Checksum

   Returns the checksum for the specified object as reported in the system
   metadata.

   :Use Cases:

     :doc:`UC09 </design/UseCases/09_uc>`

   :REST URL: N/A

   :param token: The authentication token returned by
     :func:`CN_authentication.login`

   :type token: :class:`Types.AuthToken`

   :param pid: Identifier of the object

   :type pid: :class:`Types.Identifier`

   :returns: The checksum of the specified object

   :rtype: :class:`Types.Checksum`

   :raises Exceptions.NotImplemented: ``(errorCode=501, detailCode=1402)``

   :raises Exceptions.ServiceFailure: ``(errorCode=500, detailCode=1410)``

   :raises Exceptions.NotFound: ``(errorCode=404, detailCode=1420)``

   :raises Exceptions.NotAuthorized: ``(errorCode=401, detailCode=1400)``

   :raises Exceptions.InvalidRequest: ``(errorCode=400, detailCode=1402)``

   :raises Exceptions.InvalidToken: ``(errorCode=401, detailCode=1430)``


