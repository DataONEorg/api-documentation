<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="968px" preserveAspectRatio="none" style="width:1544px;height:968px;" version="1.1" viewBox="0 0 1544 968" width="1544px" zoomAndPan="magnify"><defs><filter height="300%" id="f87h3tvfzzag" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="272" x="632.75" y="28.708">Replica Audit Task Procesing.</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="771.75" y="49.6611"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="771.75" y="70.6143"/><rect fill="#D74F57" filter="url(#f87h3tvfzzag)" height="583.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="561.5" y="278.9844"/><rect fill="#FFFFFF" filter="url(#f87h3tvfzzag)" height="539.9297" style="stroke:#000000;stroke-width:2.0;" width="1062" x="465.5" y="293.9844"/><rect fill="#FFFFFF" filter="url(#f87h3tvfzzag)" height="348.1328" style="stroke:#000000;stroke-width:2.0;" width="1042" x="475.5" y="418.5156"/><rect fill="#FFFFFF" filter="url(#f87h3tvfzzag)" height="245.7344" style="stroke:#000000;stroke-width:2.0;" width="1022" x="485.5" y="513.9141"/><rect fill="#FFFFFF" height="115.2031" style="stroke:none;stroke-width:1.0;" width="1022" x="485.5" y="644.4453"/><rect fill="#FFFFFF" filter="url(#f87h3tvfzzag)" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="1022" x="485.5" y="780.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="86" x2="86" y1="133.4531" y2="909.1797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="376.5" x2="376.5" y1="133.4531" y2="909.1797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="566.5" x2="566.5" y1="133.4531" y2="909.1797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="961.5" x2="961.5" y1="133.4531" y2="909.1797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1207.5" x2="1207.5" y1="133.4531" y2="909.1797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1416.5" x2="1416.5" y1="133.4531" y2="909.1797"/><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="158" x="5" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="52" x="58" y="101.8545">«CN-1»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="12" y="118.1514">ReplicaAuditService</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="158" x="5" y="908.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="52" x="58" y="928.1748">«CN-1»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="12" y="944.4717">ReplicaAuditService</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="213" x="268.5" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="53" x="348.5" y="101.8545">«CN-Z»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="199" x="275.5" y="118.1514">DistributedExecutorService</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="213" x="268.5" y="908.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="53" x="348.5" y="928.1748">«CN-Z»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="199" x="275.5" y="944.4717">DistributedExecutorService</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="138" x="495.5" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="53" x="538" y="101.8545">«CN-Z»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="502.5" y="118.1514">ReplicaAuditTask</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="138" x="495.5" y="908.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="53" x="538" y="928.1748">«CN-Z»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="124" x="502.5" y="944.4717">ReplicaAuditTask</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="230" x="844.5" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="53" x="933" y="101.8545">«CN-Z»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="851.5" y="118.1514">d1Client.CNode : CNodeClient</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="230" x="844.5" y="908.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="53" x="933" y="928.1748">«CN-Z»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="216" x="851.5" y="944.4717">d1Client.CNode : CNodeClient</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="234" x="1088.5" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="1178" y="101.8545">«MN-A»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="220" x="1095.5" y="118.1514">d1Client.MNode : MNodeClient</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="234" x="1088.5" y="908.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="55" x="1178" y="928.1748">«MN-A»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="220" x="1095.5" y="944.4717">d1Client.MNode : MNodeClient</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="157" x="1336.5" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="53" x="1388.5" y="101.8545">«CN-Z»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="1343.5" y="118.1514">ReplicationManager</text><rect fill="#FEFECE" filter="url(#f87h3tvfzzag)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="157" x="1336.5" y="908.1797"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="53" x="1388.5" y="928.1748">«CN-Z»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="143" x="1343.5" y="944.4717">ReplicationManager</text><rect fill="#D74F57" filter="url(#f87h3tvfzzag)" height="583.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="561.5" y="278.9844"/><rect fill="#EEEEEE" filter="url(#f87h3tvfzzag)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1537.5" x="0" y="164.0195"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1537.5" y1="164.0195" y2="164.0195"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1537.5" y1="167.0195" y2="167.0195"/><rect fill="#EEEEEE" filter="url(#f87h3tvfzzag)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="214" x="661.75" y="153.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="195" x="667.75" y="169.52">Process replication audit.</text><polygon fill="#A80036" points="365,203.7188,375,207.7188,365,211.7188,369,207.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="86" x2="371" y1="207.7188" y2="207.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="93" y="202.6528">submit(replicaAuditTask);</text><line style="stroke:#A80036;stroke-width:1.0;" x1="377" x2="419" y1="236.8516" y2="236.8516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="419" x2="419" y1="236.8516" y2="249.8516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="378" x2="419" y1="249.8516" y2="249.8516"/><polygon fill="#A80036" points="388,245.8516,378,249.8516,388,253.8516,384,249.8516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="384" y="231.7856">execute(replicaAuditTask);</text><polygon fill="#A80036" points="549.5,274.9844,559.5,278.9844,549.5,282.9844,553.5,278.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="377" x2="555.5" y1="278.9844" y2="278.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="384" y="273.9185">call()</text><path d="M465.5,293.9844 L543.5,293.9844 L543.5,300.9844 L533.5,310.9844 L465.5,310.9844 L465.5,293.9844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="539.9297" style="stroke:#000000;stroke-width:2.0;" width="1062" x="465.5" y="293.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="480.5" y="307.0513">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="276" x="558.5" y="306.1948">[for each Identifier pid in auditTask.pids]</text><polygon fill="#A80036" points="949.5,328.25,959.5,332.25,949.5,336.25,953.5,332.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="955.5" y1="332.25" y2="332.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="578.5" y="327.1841">getSystemMetadata(pid);</text><polygon fill="#A80036" points="582.5,357.3828,572.5,361.3828,582.5,365.3828,578.5,361.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="576.5" x2="960.5" y1="361.3828" y2="361.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="588.5" y="356.3169">sysMetadata;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="613.5" y1="390.5156" y2="390.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="613.5" x2="613.5" y1="390.5156" y2="403.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="572.5" x2="613.5" y1="403.5156" y2="403.5156"/><polygon fill="#A80036" points="582.5,399.5156,572.5,403.5156,582.5,407.5156,578.5,403.5156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="578.5" y="385.4497">verifiedReplicaCount = 0;</text><path d="M475.5,418.5156 L553.5,418.5156 L553.5,425.5156 L543.5,435.5156 L475.5,435.5156 L475.5,418.5156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="348.1328" style="stroke:#000000;stroke-width:2.0;" width="1042" x="475.5" y="418.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="490.5" y="431.5825">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="382" x="568.5" y="430.7261">[for each Replica replica in sysMetadata.getReplicaList()]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="613.5" y1="456.7813" y2="456.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="613.5" x2="613.5" y1="456.7813" y2="469.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="572.5" x2="613.5" y1="469.7813" y2="469.7813"/><polygon fill="#A80036" points="582.5,465.7813,572.5,469.7813,582.5,473.7813,578.5,469.7813" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="578.5" y="451.7153">mnA = getMNodeClient(replica.getReplicaMemberNode());</text><polygon fill="#A80036" points="1195.5,494.9141,1205.5,498.9141,1195.5,502.9141,1199.5,498.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="1201.5" y1="498.9141" y2="498.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="412" x="578.5" y="493.8481">replicaChecksum = getChecksum(pid, sysMeta.getChecksum());</text><path d="M485.5,513.9141 L551.5,513.9141 L551.5,520.9141 L541.5,530.9141 L485.5,530.9141 L485.5,513.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="245.7344" style="stroke:#000000;stroke-width:2.0;" width="1022" x="485.5" y="513.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="500.5" y="526.981">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="351" x="566.5" y="526.1245">[if replicaChecksum == sysMetadata.getChecksum()]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="613.5" y1="552.1797" y2="552.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="613.5" x2="613.5" y1="552.1797" y2="565.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="572.5" x2="613.5" y1="565.1797" y2="565.1797"/><polygon fill="#A80036" points="582.5,561.1797,572.5,565.1797,582.5,569.1797,578.5,565.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="578.5" y="547.1138">verfiedReplicaCount++;</text><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="613.5" y1="594.3125" y2="594.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="613.5" x2="613.5" y1="594.3125" y2="607.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="572.5" x2="613.5" y1="607.3125" y2="607.3125"/><polygon fill="#A80036" points="582.5,603.3125,572.5,607.3125,582.5,611.3125,578.5,607.3125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="578.5" y="589.2466">replica.updateVerifiedDate(today);</text><polygon fill="#A80036" points="949.5,632.4453,959.5,636.4453,949.5,640.4453,953.5,636.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="955.5" y1="636.4453" y2="636.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="578.5" y="631.3794">updateReplicationMetadata(pid, replica);</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="485.5" x2="1507.5" y1="645.4453" y2="645.4453"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="490.5" y="655.6558">[else]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="613.5" y1="680.3828" y2="680.3828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="613.5" x2="613.5" y1="680.3828" y2="693.3828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="572.5" x2="613.5" y1="693.3828" y2="693.3828"/><polygon fill="#A80036" points="582.5,689.3828,572.5,693.3828,582.5,697.3828,578.5,693.3828" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="578.5" y="675.3169">replica.setReplicationStatus(INVALID);</text><polygon fill="#A80036" points="949.5,718.5156,959.5,722.5156,949.5,726.5156,953.5,722.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="955.5" y1="722.5156" y2="722.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="578.5" y="717.4497">updateReplicationMetadata(pid, replica);</text><polygon fill="#A80036" points="1405,747.6484,1415,751.6484,1405,755.6484,1409,751.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="1411" y1="751.6484" y2="751.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="578.5" y="746.5825">createAndQueueTasks(pid);</text><path d="M485.5,780.6484 L551.5,780.6484 L551.5,787.6484 L541.5,797.6484 L485.5,797.6484 L485.5,780.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="1022" x="485.5" y="780.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="500.5" y="793.7153">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="567" x="566.5" y="792.8589">[if sysMetadata.getReplicationPolicy().getNumberReplicas !== verifiedReplicaCount]</text><polygon fill="#A80036" points="1405,814.9141,1415,818.9141,1405,822.9141,1409,818.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="571.5" x2="1411" y1="818.9141" y2="818.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="578.5" y="813.8481">createAndQueueTasks(pid);</text><polygon fill="#A80036" points="388,858.0469,378,862.0469,388,866.0469,384,862.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="382" x2="565.5" y1="862.0469" y2="862.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="394" y="856.981">String audit result</text><polygon fill="#A80036" points="97,887.1797,87,891.1797,97,895.1797,93,891.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="91" x2="376" y1="891.1797" y2="891.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="103" y="886.1138">Future - audit results including exceptions</text><!--MD5=[71aa1bf8b3d9306f139882eaa17827b4]
@startuml
skinparam notebordercolor #AAAAAA
   skinparam notefontcolor #222222
   title Replica Audit Task Procesing.\n\n
 participant "ReplicaAuditService" as cnAudit <<CN-1>>
   participant "DistributedExecutorService" as cnZ <<CN-Z>>
   participant "ReplicaAuditTask" as auditTask <<CN-Z>>
   participant "d1Client.CNode : CNodeClient" as cNodeClient <<CN-Z>>
 participant "d1Client.MNode : MNodeClient" as mnA <<MN-A>>
 participant "ReplicationManager" as repManager <<CN-Z>>

== Process replication audit. ==
 cnAudit -> cnZ : submit(replicaAuditTask);
   cnZ -> cnZ: execute(replicaAuditTask);
   cnZ -> auditTask : call()
   activate auditTask #D74F57

 loop for each Identifier pid in auditTask.pids
     auditTask -> cNodeClient : getSystemMetadata(pid);
     cNodeClient - -> auditTask : sysMetadata;
     auditTask -> auditTask : verifiedReplicaCount = 0;
     loop for each Replica replica in sysMetadata.getReplicaList()
       auditTask -> auditTask : mnA = getMNodeClient(replica.getReplicaMemberNode());
       auditTask -> mnA : replicaChecksum = getChecksum(pid, sysMeta.getChecksum());
       alt if replicaChecksum == sysMetadata.getChecksum()
         auditTask -> auditTask : verfiedReplicaCount++;
         auditTask -> auditTask : replica.updateVerifiedDate(today);
         auditTask -> cNodeClient : updateReplicationMetadata(pid, replica);
       else else
         auditTask -> auditTask : replica.setReplicationStatus(INVALID);
         auditTask -> cNodeClient : updateReplicationMetadata(pid, replica);
         auditTask -> repManager : createAndQueueTasks(pid);
       end
     end loop
     alt if sysMetadata.getReplicationPolicy().getNumberReplicas !== verifiedReplicaCount
       auditTask -> repManager : createAndQueueTasks(pid);
     end
   end loop

 auditTask - -> cnZ : String audit result
 deactivate auditTask

 cnZ - -> cnAudit : Future - audit results including exceptions
@enduml

PlantUML version 1.2020.21beta3(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>