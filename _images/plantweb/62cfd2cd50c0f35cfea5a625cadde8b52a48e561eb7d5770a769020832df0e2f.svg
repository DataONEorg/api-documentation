<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1001px" preserveAspectRatio="none" style="width:752px;height:1001px;" version="1.1" viewBox="0 0 752 1001" width="752px" zoomAndPan="magnify"><defs><filter height="300%" id="fk8ks6sds1d77" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="509" x="119.5" y="28.708">Register two existing accounts as equivalent identities</text><rect fill="#FFFFFF" filter="url(#fk8ks6sds1d77)" height="175.7969" style="stroke:#000000;stroke-width:2.0;" width="728" x="10" y="162.8125"/><rect fill="#FFFFFF" filter="url(#fk8ks6sds1d77)" height="316.4609" style="stroke:#000000;stroke-width:2.0;" width="728" x="10" y="380.6094"/><rect fill="#FFFFFF" filter="url(#fk8ks6sds1d77)" height="185.7969" style="stroke:#000000;stroke-width:2.0;" width="728" x="10" y="739.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="91.5469" y2="345.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="345.6094" y2="373.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="373.6094" y2="704.0703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="704.0703" y2="732.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="732.0703" y2="941.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="317" y1="91.5469" y2="345.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="317" x2="317" y1="345.6094" y2="373.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="317" y1="373.6094" y2="704.0703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="317" x2="317" y1="704.0703" y2="732.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="317" y1="732.0703" y2="941.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="664" x2="664" y1="91.5469" y2="345.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="664" x2="664" y1="345.6094" y2="373.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="664" x2="664" y1="373.6094" y2="704.0703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="664" x2="664" y1="704.0703" y2="732.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="664" x2="664" y1="732.0703" y2="941.8672"/><rect fill="#FEFECE" filter="url(#fk8ks6sds1d77)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="20" y="56.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="27" y="76.2451">CILogon</text><rect fill="#FEFECE" filter="url(#fk8ks6sds1d77)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="20" y="940.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="27" y="960.8623">CILogon</text><rect fill="#FEFECE" filter="url(#fk8ks6sds1d77)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="112" x="259" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="98" x="266" y="59.9482">«Application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="293.5" y="76.2451">Client</text><rect fill="#FEFECE" filter="url(#fk8ks6sds1d77)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="112" x="259" y="940.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="98" x="266" y="960.8623">«Application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="293.5" y="977.1592">Client</text><rect fill="#FEFECE" filter="url(#fk8ks6sds1d77)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="124" x="600" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="629.5" y="59.9482">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="607" y="76.2451">IdentityService</text><rect fill="#FEFECE" filter="url(#fk8ks6sds1d77)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="124" x="600" y="940.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="629.5" y="960.8623">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="607" y="977.1592">IdentityService</text><path d="M322,106.5469 L322,146.5469 L499,146.5469 L499,116.5469 L489,106.5469 L322,106.5469 " fill="#FBFB77" filter="url(#fk8ks6sds1d77)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M489,106.5469 L489,116.5469 L499,116.5469 L489,106.5469 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="328" y="123.6138">Client controlled by User</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="328" y="138.7466">who has two identities</text><path d="M10,162.8125 L191,162.8125 L191,169.8125 L181,179.8125 L10,179.8125 L10,162.8125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="175.7969" style="stroke:#000000;stroke-width:2.0;" width="728" x="10" y="162.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="25" y="175.8794">username@NCEAS</text><polygon fill="#A80036" points="69,197.0781,59,201.0781,69,205.0781,65,201.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="316" y1="201.0781" y2="201.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="75" y="196.0122">authenticate with primary identity</text><polygon fill="#A80036" points="305,226.2109,315,230.2109,305,234.2109,309,230.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="311" y1="230.2109" y2="230.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="65" y="225.145">X.509</text><polygon fill="#A80036" points="652,255.3438,662,259.3438,652,263.3438,656,259.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="658" y1="259.3438" y2="259.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="324" y="254.2778">registerAccount(Types.Session, Types.Person)</text><polygon fill="#A80036" points="328,284.4766,318,288.4766,328,292.4766,324,288.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="322" x2="663" y1="288.4766" y2="288.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="334" y="283.4106">Types.Subject</text><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="359" y1="317.6094" y2="317.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="359" x2="359" y1="317.6094" y2="330.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="359" y1="330.6094" y2="330.6094"/><polygon fill="#A80036" points="328,326.6094,318,330.6094,328,334.6094,324,330.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="324" y="312.5435">logout (dispose X.509)</text><path d="M10,380.6094 L181,380.6094 L181,387.6094 L171,397.6094 L10,397.6094 L10,380.6094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="316.4609" style="stroke:#000000;stroke-width:2.0;" width="728" x="10" y="380.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="126" x="25" y="393.6763">username@UCSB</text><polygon fill="#A80036" points="69,414.875,59,418.875,69,422.875,65,418.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="316" y1="418.875" y2="418.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="75" y="413.8091">authenticate with secondary identity</text><polygon fill="#A80036" points="305,444.0078,315,448.0078,305,452.0078,309,448.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="311" y1="448.0078" y2="448.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="65" y="442.9419">X.509</text><polygon fill="#A80036" points="652,473.1406,662,477.1406,652,481.1406,656,477.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="658" y1="477.1406" y2="477.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="324" y="472.0747">listSubjects()</text><polygon fill="#A80036" points="328,502.2734,318,506.2734,328,510.2734,324,506.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="322" x2="663" y1="506.2734" y2="506.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="334" y="501.2075">Types.SubjectList</text><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="359" y1="535.4063" y2="535.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="359" x2="359" y1="535.4063" y2="548.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="359" y1="548.4063" y2="548.4063"/><polygon fill="#A80036" points="328,544.4063,318,548.4063,328,552.4063,324,548.4063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="324" y="530.3403">select equivalent Types.Subject</text><polygon fill="#A80036" points="652,573.5391,662,577.5391,652,581.5391,656,577.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="658" y1="577.5391" y2="577.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="277" x="324" y="572.4731">mapIdentity(Types.Session, Types.Subject)</text><polygon fill="#A80036" points="328,622.8047,318,626.8047,328,630.8047,324,626.8047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="322" x2="663" y1="626.8047" y2="626.8047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="334" y="621.7388">boolean</text><path d="M165,590.5391 L165,645.5391 L308,645.5391 L308,600.5391 L298,590.5391 L165,590.5391 " fill="#FBFB77" filter="url(#fk8ks6sds1d77)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M298,590.5391 L298,600.5391 L308,600.5391 L298,590.5391 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="171" y="607.606">request must be</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="171" y="622.7388">confirmed before</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="171" y="637.8716">equivalence is final</text><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="359" y1="676.0703" y2="676.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="359" x2="359" y1="676.0703" y2="689.0703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="359" y1="689.0703" y2="689.0703"/><polygon fill="#A80036" points="328,685.0703,318,689.0703,328,693.0703,324,689.0703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="324" y="671.0044">logout (dispose X.509)</text><path d="M10,739.0703 L191,739.0703 L191,746.0703 L181,756.0703 L10,756.0703 L10,739.0703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="185.7969" style="stroke:#000000;stroke-width:2.0;" width="728" x="10" y="739.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="25" y="752.1372">username@NCEAS</text><polygon fill="#A80036" points="69,773.3359,59,777.3359,69,781.3359,65,777.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="316" y1="777.3359" y2="777.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="75" y="772.27">authenticate with primary identity</text><polygon fill="#A80036" points="305,802.4688,315,806.4688,305,810.4688,309,806.4688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="311" y1="806.4688" y2="806.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="65" y="801.4028">X.509</text><polygon fill="#A80036" points="652,831.6016,662,835.6016,652,839.6016,656,835.6016" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="658" y1="835.6016" y2="835.6016"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="323" x="324" y="830.5356">confirmMapIdentity(Types.Session, Types.Subject)</text><polygon fill="#A80036" points="328,865.7344,318,869.7344,328,873.7344,324,869.7344" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="322" x2="663" y1="869.7344" y2="869.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="334" y="864.6685">boolean</text><path d="M127,848.6016 L127,873.6016 L308,873.6016 L308,858.6016 L298,848.6016 L127,848.6016 " fill="#FBFB77" filter="url(#fk8ks6sds1d77)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M298,848.6016 L298,858.6016 L308,858.6016 L298,848.6016 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="133" y="865.6685">equivalence is confirmed</text><line style="stroke:#A80036;stroke-width:1.0;" x1="317" x2="359" y1="903.8672" y2="903.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="359" x2="359" y1="903.8672" y2="916.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="359" y1="916.8672" y2="916.8672"/><polygon fill="#A80036" points="328,912.8672,318,916.8672,328,920.8672,324,916.8672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="324" y="898.8013">logout (dispose X.509)</text><!--MD5=[7574e49f289cf188748d262873600c76]
@startuml
title Register two existing accounts as equivalent identities
participant "CILogon" as cilogon
participant "Client" as client << Application >>
  note right of client
    Client controlled by User
    who has two identities
  end note
participant "IdentityService" as ident << CNode >>

group username@NCEAS
  'authenticate as primary id
  client -> cilogon:authenticate with primary identity
  client <- cilogon: X.509
  'register this identity with DataONE
  client -> ident: registerAccount(Types.Session, Types.Person)
  ident - -> client: Types.Subject
  client -> client:logout (dispose X.509)
end
...
group username@UCSB
  'authenticate as secondary id
  client -> cilogon:authenticate with secondary identity
  client <- cilogon: X.509
  'list existing Subjects
  client -> ident:listSubjects()
  ident - -> client:Types.SubjectList
  client -> client:select equivalent Types.Subject
  'request to map identity with existing Subject
  client -> ident: mapIdentity(Types.Session, Types.Subject)
  ident - -> client: boolean
  note left
    request must be
    confirmed before
    equivalence is final
  end note
  client -> client:logout (dispose X.509)
end
...
group username@NCEAS
  'authenticate as primary id
  client -> cilogon:authenticate with primary identity
  client <- cilogon: X.509
  'confirm mapping identity with DataONE
  client -> ident: confirmMapIdentity(Types.Session, Types.Subject)
  ident - -> client: boolean
  note left
    equivalence is confirmed
  end note
  client -> client:logout (dispose X.509)
end
@enduml

@startuml
title Register two existing accounts as equivalent identities
participant "CILogon" as cilogon
participant "Client" as client << Application >>
  note right of client
    Client controlled by User
    who has two identities
  end note
participant "IdentityService" as ident << CNode >>

group username@NCEAS
  client -> cilogon:authenticate with primary identity
  client <- cilogon: X.509
  client -> ident: registerAccount(Types.Session, Types.Person)
  ident - -> client: Types.Subject
  client -> client:logout (dispose X.509)
end
...
group username@UCSB
  client -> cilogon:authenticate with secondary identity
  client <- cilogon: X.509
  client -> ident:listSubjects()
  ident - -> client:Types.SubjectList
  client -> client:select equivalent Types.Subject
  client -> ident: mapIdentity(Types.Session, Types.Subject)
  ident - -> client: boolean
  note left
    request must be
    confirmed before
    equivalence is final
  end note
  client -> client:logout (dispose X.509)
end
...
group username@NCEAS
  client -> cilogon:authenticate with primary identity
  client <- cilogon: X.509
  client -> ident: confirmMapIdentity(Types.Session, Types.Subject)
  ident - -> client: boolean
  note left
    equivalence is confirmed
  end note
  client -> client:logout (dispose X.509)
end
@enduml

PlantUML version 1.2020.21beta3(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>