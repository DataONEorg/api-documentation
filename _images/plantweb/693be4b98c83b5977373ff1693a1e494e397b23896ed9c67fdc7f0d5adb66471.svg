<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="716px" preserveAspectRatio="none" style="width:722px;height:716px;" version="1.1" viewBox="0 0 722 716" width="722px" zoomAndPan="magnify"><defs><filter height="300%" id="fbsg41i7pb1co" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="376" x="171" y="28.708">Register untrusted account and verify it</text><rect fill="#FFFFFF" filter="url(#fbsg41i7pb1co)" height="175.7969" style="stroke:#000000;stroke-width:2.0;" width="698" x="10" y="162.8125"/><rect fill="#FFFFFF" filter="url(#fbsg41i7pb1co)" height="259.1953" style="stroke:#000000;stroke-width:2.0;" width="698" x="10" y="380.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="91.5469" y2="345.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="58" x2="58" y1="345.6094" y2="373.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="58" y1="373.6094" y2="656.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="312" y1="91.5469" y2="345.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="312" x2="312" y1="345.6094" y2="373.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="312" y1="373.6094" y2="656.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="634" x2="634" y1="91.5469" y2="345.6094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:1.0,4.0;" x1="634" x2="634" y1="345.6094" y2="373.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="634" x2="634" y1="373.6094" y2="656.8047"/><rect fill="#FEFECE" filter="url(#fbsg41i7pb1co)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="20" y="56.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="27" y="76.2451">CILogon</text><rect fill="#FEFECE" filter="url(#fbsg41i7pb1co)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="20" y="655.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="27" y="675.7998">CILogon</text><rect fill="#FEFECE" filter="url(#fbsg41i7pb1co)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="112" x="254" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="98" x="261" y="59.9482">«Application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="288.5" y="76.2451">Client</text><rect fill="#FEFECE" filter="url(#fbsg41i7pb1co)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="112" x="254" y="655.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="98" x="261" y="675.7998">«Application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="288.5" y="692.0967">Client</text><rect fill="#FEFECE" filter="url(#fbsg41i7pb1co)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="124" x="570" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="599.5" y="59.9482">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="577" y="76.2451">IdentityService</text><rect fill="#FEFECE" filter="url(#fbsg41i7pb1co)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="124" x="570" y="655.8047"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="599.5" y="675.7998">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="577" y="692.0967">IdentityService</text><path d="M317,106.5469 L317,146.5469 L494,146.5469 L494,116.5469 L484,106.5469 L317,106.5469 " fill="#FBFB77" filter="url(#fbsg41i7pb1co)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M484,106.5469 L484,116.5469 L494,116.5469 L484,106.5469 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="323" y="123.6138">Client controlled by User</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="323" y="138.7466">and by Admin</text><path d="M10,162.8125 L193,162.8125 L193,169.8125 L183,179.8125 L10,179.8125 L10,162.8125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="175.7969" style="stroke:#000000;stroke-width:2.0;" width="698" x="10" y="162.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="138" x="25" y="175.8794">username@google</text><polygon fill="#A80036" points="69,197.0781,59,201.0781,69,205.0781,65,201.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="311" y1="201.0781" y2="201.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="75" y="196.0122">authenticate with untrusted identity</text><polygon fill="#A80036" points="300,226.2109,310,230.2109,300,234.2109,304,230.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="306" y1="230.2109" y2="230.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="65" y="225.145">X.509</text><polygon fill="#A80036" points="622,255.3438,632,259.3438,622,263.3438,626,259.3438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="628" y1="259.3438" y2="259.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="319" y="254.2778">registerAccount(Types.Session, Types.Person)</text><polygon fill="#A80036" points="323,284.4766,313,288.4766,323,292.4766,319,288.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="317" x2="633" y1="288.4766" y2="288.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="329" y="283.4106">Types.Subject</text><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="354" y1="317.6094" y2="317.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="354" x2="354" y1="317.6094" y2="330.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="313" x2="354" y1="330.6094" y2="330.6094"/><polygon fill="#A80036" points="323,326.6094,313,330.6094,323,334.6094,319,330.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="319" y="312.5435">logout (dispose X.509)</text><path d="M10,380.6094 L152,380.6094 L152,387.6094 L142,397.6094 L10,397.6094 L10,380.6094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="259.1953" style="stroke:#000000;stroke-width:2.0;" width="698" x="10" y="380.6094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="25" y="393.6763">admin@UCSB</text><polygon fill="#A80036" points="69,414.875,59,418.875,69,422.875,65,418.875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="311" y1="418.875" y2="418.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="75" y="413.8091">administrator authenticate</text><polygon fill="#A80036" points="300,444.0078,310,448.0078,300,452.0078,304,448.0078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="58" x2="306" y1="448.0078" y2="448.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="65" y="442.9419">X.509</text><polygon fill="#A80036" points="622,473.1406,632,477.1406,622,481.1406,626,477.1406" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="628" y1="477.1406" y2="477.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="292" x="319" y="472.0747">getSubjectInfo(Types.Session, Types.Subject)</text><polygon fill="#A80036" points="323,514.8398,313,518.8398,323,522.8398,319,518.8398" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="317" x2="633" y1="518.8398" y2="518.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="329" y="513.7739">Types.Person</text><path d="M151,490.1406 L151,530.1406 L303,530.1406 L303,500.1406 L293,490.1406 L151,490.1406 " fill="#FBFB77" filter="url(#fbsg41i7pb1co)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M293,490.1406 L293,500.1406 L303,500.1406 L293,490.1406 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="157" y="507.2075">Administrator must</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="157" y="522.3403">verify Person details</text><polygon fill="#A80036" points="622,556.5391,632,560.5391,622,564.5391,626,560.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="628" y1="560.5391" y2="560.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="285" x="319" y="555.4731">verifyIdentity(Types.Session, Types.Subject)</text><polygon fill="#A80036" points="323,585.6719,313,589.6719,323,593.6719,319,589.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="317" x2="633" y1="589.6719" y2="589.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="329" y="584.606">boolean</text><line style="stroke:#A80036;stroke-width:1.0;" x1="312" x2="354" y1="618.8047" y2="618.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="354" x2="354" y1="618.8047" y2="631.8047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="313" x2="354" y1="631.8047" y2="631.8047"/><polygon fill="#A80036" points="323,627.8047,313,631.8047,323,635.8047,319,631.8047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="319" y="613.7388">logout (dispose X.509)</text><!--MD5=[eb5e2bd13b7ea848a36589c3c30af1c2]
@startuml
title Register untrusted account and verify it
participant "CILogon" as cilogon
participant "Client" as client << Application >>
  note right of client
    Client controlled by User
    and by Admin
  end note
participant "IdentityService" as ident << CNode >>

group username@google
  'authenticate as primary id
  client -> cilogon:authenticate with untrusted identity
  client <- cilogon: X.509
  'register this identity with DataONE
  client -> ident: registerAccount(Types.Session, Types.Person)
  ident - -> client: Types.Subject
  client -> client:logout (dispose X.509)
end
...
group admin@UCSB
  'authenticate as secondary id
  client -> cilogon:administrator authenticate
  client <- cilogon: X.509
  client -> ident:getSubjectInfo(Types.Session, Types.Subject)
  ident - -> client:Types.Person
  note left
    Administrator must
    verify Person details
  end note
  'request to map identity with existing Subject
  client -> ident: verifyIdentity(Types.Session, Types.Subject)
  ident - -> client: boolean
  client -> client:logout (dispose X.509)
end
@enduml

@startuml
title Register untrusted account and verify it
participant "CILogon" as cilogon
participant "Client" as client << Application >>
  note right of client
    Client controlled by User
    and by Admin
  end note
participant "IdentityService" as ident << CNode >>

group username@google
  client -> cilogon:authenticate with untrusted identity
  client <- cilogon: X.509
  client -> ident: registerAccount(Types.Session, Types.Person)
  ident - -> client: Types.Subject
  client -> client:logout (dispose X.509)
end
...
group admin@UCSB
  client -> cilogon:administrator authenticate
  client <- cilogon: X.509
  client -> ident:getSubjectInfo(Types.Session, Types.Subject)
  ident - -> client:Types.Person
  note left
    Administrator must
    verify Person details
  end note
  client -> ident: verifyIdentity(Types.Session, Types.Subject)
  ident - -> client: boolean
  client -> client:logout (dispose X.509)
end
@enduml

PlantUML version 1.2020.21beta3(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>