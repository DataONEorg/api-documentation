<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2209px" preserveAspectRatio="none" style="width:1258px;height:2209px;" version="1.1" viewBox="0 0 1258 2209" width="1258px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rsammdpqe1hx" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="450" x="400.75" y="28.708">Replicate an object between two Member Nodes</text><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="628.75" y="49.6611"/><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="0" x="628.75" y="70.6143"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="1847.6953"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="34.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="2008.4922"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="199.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="267.5" y="1647.8984"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="44.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="267.5" y="1935.0938"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="444.2578" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="227.8516"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="579.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="778.5078"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="695.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="944.5" y="1429.8359"/><rect fill="#E9967A" filter="url(#f1rsammdpqe1hx)" height="105.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="1571.6328"/><rect fill="#FFFFFF" filter="url(#f1rsammdpqe1hx)" height="182.9297" style="stroke:#000000;stroke-width:2.0;" width="698.5" x="329" y="504.1797"/><rect fill="#FFFFFF" filter="url(#f1rsammdpqe1hx)" height="266.8672" style="stroke:#000000;stroke-width:2.0;" width="680.5" x="299" y="926.1719"/><rect fill="#FFFFFF" filter="url(#f1rsammdpqe1hx)" height="193.6016" style="stroke:#000000;stroke-width:2.0;" width="660.5" x="309" y="992.4375"/><rect fill="#FFFFFF" filter="url(#f1rsammdpqe1hx)" height="162.4688" style="stroke:#000000;stroke-width:2.0;" width="640.5" x="319" y="1016.5703"/><rect fill="#FFFFFF" filter="url(#f1rsammdpqe1hx)" height="131.3359" style="stroke:#000000;stroke-width:2.0;" width="620.5" x="329" y="1040.7031"/><rect fill="#FFFFFF" height="72.0703" style="stroke:none;stroke-width:1.0;" width="620.5" x="329" y="1099.9688"/><rect fill="#FFFFFF" filter="url(#f1rsammdpqe1hx)" height="143.5313" style="stroke:#000000;stroke-width:2.0;" width="550.5" x="329" y="1207.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="61" x2="61" y1="133.4531" y2="2149.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="272" x2="272" y1="133.4531" y2="2149.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="478" x2="478" y1="133.4531" y2="2149.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="949" x2="949" y1="133.4531" y2="2149.8906"/><rect fill="#FEFECE" filter="url(#f1rsammdpqe1hx)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="67" x="26" y="101.8545">«MNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="12" y="118.1514">mnA : MNode</text><rect fill="#FEFECE" filter="url(#f1rsammdpqe1hx)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="109" x="5" y="2148.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="67" x="26" y="2168.8857">«MNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="12" y="2185.1826">mnA : MNode</text><rect fill="#FEFECE" filter="url(#f1rsammdpqe1hx)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="109" x="216" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="67" x="237" y="101.8545">«MNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="223" y="118.1514">mnB : MNode</text><rect fill="#FEFECE" filter="url(#f1rsammdpqe1hx)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="109" x="216" y="2148.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="67" x="237" y="2168.8857">«MNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="223" y="2185.1826">mnB : MNode</text><rect fill="#FEFECE" filter="url(#f1rsammdpqe1hx)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="275" x="339" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="444" y="101.8545">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="261" x="346" y="118.1514">cnXReplService : ReplicationService</text><rect fill="#FEFECE" filter="url(#f1rsammdpqe1hx)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="275" x="339" y="2148.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="444" y="2168.8857">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="261" x="346" y="2185.1826">cnXReplService : ReplicationService</text><rect fill="#FEFECE" filter="url(#f1rsammdpqe1hx)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="275" x="810" y="81.8594"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="915" y="101.8545">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="261" x="817" y="118.1514">cnZReplService : ReplicationService</text><rect fill="#FEFECE" filter="url(#f1rsammdpqe1hx)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="275" x="810" y="2148.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="915" y="2168.8857">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="261" x="817" y="2185.1826">cnZReplService : ReplicationService</text><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="87.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="1847.6953"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="34.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="56.5" y="2008.4922"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="199.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="267.5" y="1647.8984"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="44.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="267.5" y="1935.0938"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="444.2578" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="227.8516"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="579.0625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="473.5" y="778.5078"/><rect fill="#D74F57" filter="url(#f1rsammdpqe1hx)" height="695.0547" style="stroke:#A80036;stroke-width:1.0;" width="10" x="944.5" y="1429.8359"/><rect fill="#E9967A" filter="url(#f1rsammdpqe1hx)" height="105.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="949.5" y="1571.6328"/><rect fill="#EEEEEE" filter="url(#f1rsammdpqe1hx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1251.5" x="0" y="164.0195"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1251.5" y1="164.0195" y2="164.0195"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1251.5" y1="167.0195" y2="167.0195"/><rect fill="#EEEEEE" filter="url(#f1rsammdpqe1hx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="156" x="547.75" y="153.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="553.75" y="169.52">Replication Event</text><polygon fill="#A80036" points="461.5,223.8516,471.5,227.8516,461.5,231.8516,465.5,227.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="0" x2="467.5" y1="227.8516" y2="227.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="7" y="222.7856">hzSystemMetadata.put(pid, sysmeta)</text><path d="M488,191.5859 L488,246.5859 L806,246.5859 L806,201.5859 L796,191.5859 L488,191.5859 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M796,191.5859 L796,201.5859 L806,201.5859 L796,191.5859 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="494" y="208.6528">Synchronization services adds entry to</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="494" y="223.7856">SystemMetadata map managed by Hazelcast,</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="494" y="238.9185">EntryEvent is fired</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="277.1172" y2="277.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="277.1172" y2="290.1172"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="290.1172" y2="290.1172"/><polygon fill="#A80036" points="494.5,286.1172,484.5,290.1172,494.5,294.1172,490.5,290.1172" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="490.5" y="272.0513">entryAdded(EntryEvent&lt;pid, sysmeta&gt;)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="319.25" y2="319.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="319.25" y2="332.25"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="332.25" y2="332.25"/><polygon fill="#A80036" points="494.5,328.25,484.5,332.25,494.5,336.25,490.5,332.25" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="490.5" y="314.1841">queueEvent(pid)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="397.7148" y2="397.7148"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="397.7148" y2="410.7148"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="410.7148" y2="410.7148"/><polygon fill="#A80036" points="494.5,406.7148,484.5,410.7148,494.5,414.7148,490.5,410.7148" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="490.5" y="392.6489">itemAdded(pid)</text><path d="M601,345.25 L601,445.25 L1001,445.25 L1001,355.25 L991,345.25 L601,345.25 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M991,345.25 L991,355.25 L1001,355.25 L991,345.25 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="607" y="362.3169">hzReplicationEvents.offer(pid) is called to keep track of</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="379" x="607" y="377.4497">frequent hzSystemMetadata change events. When popped</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="607" y="392.5825">off of the queue, identifiers are placed into the</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="332" x="607" y="407.7153">hzHandledReplicationEvents set until the evaluation</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="607" y="422.8481">to create a task or not is complete. This prevents</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="341" x="607" y="437.981">multiple task creation across CNs for the same event</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="476.1797" y2="476.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="476.1797" y2="489.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="489.1797" y2="489.1797"/><polygon fill="#A80036" points="494.5,485.1797,484.5,489.1797,494.5,493.1797,490.5,489.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="490.5" y="471.1138">createAndQueueTasks(pid)</text><path d="M329,504.1797 L407,504.1797 L407,511.1797 L397,521.1797 L329,521.1797 L329,504.1797 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="182.9297" style="stroke:#000000;stroke-width:2.0;" width="698.5" x="329" y="504.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="344" y="517.2466">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="177" x="422" y="516.3901">[for each ReplicationTask]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="548.5117" y2="548.5117"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="548.5117" y2="561.5117"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="561.5117" y2="561.5117"/><polygon fill="#A80036" points="494.5,557.5117,484.5,561.5117,494.5,565.5117,490.5,561.5117" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="490.5" y="543.4458">taskid = idGenerator.newId()</text><path d="M686,526.3125 L686,566.3125 L1003,566.3125 L1003,536.3125 L993,526.3125 L686,526.3125 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M993,526.3125 L993,536.3125 L1003,536.3125 L993,526.3125 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="296" x="692" y="543.3794">Hazelcast.getIdGenerator("task-ids") has been</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="692" y="558.5122">called in ReplicationService constructor</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="602.7773" y2="602.7773"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="602.7773" y2="615.7773"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="615.7773" y2="615.7773"/><polygon fill="#A80036" points="494.5,611.7773,484.5,615.7773,494.5,619.7773,490.5,615.7773" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="490.5" y="597.7114">hzReplicationTaskQueue.put(taskid, task)</text><path d="M767,580.5781 L767,620.5781 L995,620.5781 L995,590.5781 L985,580.5781 L767,580.5781 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M985,580.5781 L985,590.5781 L995,590.5781 L985,580.5781 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="773" y="597.645">Hazelcast distributes Replication</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="773" y="612.7778">Tasks to all CNs</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="671.1094" y2="671.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="671.1094" y2="684.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="478.5" x2="525.5" y1="684.1094" y2="684.1094"/><polygon fill="#A80036" points="488.5,680.1094,478.5,684.1094,488.5,688.1094,484.5,684.1094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="490.5" y="650.9106">setReplicationStatus(session, pid,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="506.5" y="666.0435">nodeRef, ReplicationStatus.QUEUED)</text><rect fill="#EEEEEE" filter="url(#f1rsammdpqe1hx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1251.5" x="0" y="714.6758"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1251.5" y1="714.6758" y2="714.6758"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1251.5" y1="717.6758" y2="717.6758"/><rect fill="#EEEEEE" filter="url(#f1rsammdpqe1hx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="210" x="520.75" y="704.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="191" x="526.75" y="720.1763">Regular Replication Audit</text><polygon fill="#A80036" points="461.5,774.5078,471.5,778.5078,461.5,782.5078,465.5,778.5078" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="0" x2="467.5" y1="778.5078" y2="778.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="7" y="773.4419">auditReplicas()</text><path d="M488,742.2422 L488,797.2422 L849,797.2422 L849,752.2422 L839,742.2422 L488,742.2422 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M839,742.2422 L839,752.2422 L849,752.2422 L839,742.2422 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="339" x="494" y="759.3091">Query the Metacat database to receive a short list of</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="494" y="774.4419">tasks which have not had their checksums verified in</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="494" y="789.5747">greater than 2 months</text><polygon fill="#A80036" points="1239.5,823.7734,1249.5,827.7734,1239.5,831.7734,1243.5,827.7734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="1245.5" y1="827.7734" y2="827.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="490.5" y="822.7075">getAuditShortList()</text><polygon fill="#A80036" points="494.5,852.9063,484.5,856.9063,494.5,860.9063,490.5,856.9063" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="488.5" x2="1250.5" y1="856.9063" y2="856.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="55" x="500.5" y="851.8403">shortList</text><path d="M352,869.9063 L352,909.9063 L600,909.9063 L600,879.9063 L590,869.9063 L352,869.9063 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M590,869.9063 L590,879.9063 L600,879.9063 L590,869.9063 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="358" y="886.9731">Bin the tasks by NodeReference for</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="358" y="902.106">bulk processing my MNAuditTask</text><path d="M299,926.1719 L377,926.1719 L377,933.1719 L367,943.1719 L299,943.1719 L299,926.1719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="266.8672" style="stroke:#000000;stroke-width:2.0;" width="680.5" x="299" y="926.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="314" y="939.2388">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="217" x="392" y="938.3823">[for each Identifier in shortList]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="964.4375" y2="964.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="964.4375" y2="977.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="977.4375" y2="977.4375"/><polygon fill="#A80036" points="494.5,973.4375,484.5,977.4375,494.5,981.4375,490.5,977.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="490.5" y="959.3716">hzSystemMetadata.get(Identifier).getReplicaList()</text><path d="M309,992.4375 L387,992.4375 L387,999.4375 L377,1009.4375 L309,1009.4375 L309,992.4375 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="193.6016" style="stroke:#000000;stroke-width:2.0;" width="660.5" x="309" y="992.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="324" y="1005.5044">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="228" x="402" y="1004.6479">[for each Replica in List&lt;Replica&gt;]</text><path d="M319,1016.5703 L385,1016.5703 L385,1023.5703 L375,1033.5703 L319,1033.5703 L319,1016.5703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="162.4688" style="stroke:#000000;stroke-width:2.0;" width="640.5" x="319" y="1016.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="334" y="1029.6372">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="331" x="400" y="1028.7808">[if Replica.replicaVerified is older than 2 months]</text><path d="M329,1040.7031 L395,1040.7031 L395,1047.7031 L385,1057.7031 L329,1057.7031 L329,1040.7031 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="131.3359" style="stroke:#000000;stroke-width:2.0;" width="620.5" x="329" y="1040.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="344" y="1053.77">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="396" x="410" y="1052.9136">[if auditTaskMap.containsKey(Replica.replicaMemberNode)]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="1078.9688" y2="1078.9688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="1078.9688" y2="1091.9688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="1091.9688" y2="1091.9688"/><polygon fill="#A80036" points="494.5,1087.9688,484.5,1091.9688,494.5,1095.9688,490.5,1091.9688" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="394" x="490.5" y="1073.9028">auditTaskMap.get(Replica.replicaMemberNode).add(Identifier)</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="329" x2="949.5" y1="1100.9688" y2="1100.9688"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="334" y="1111.1792">[else]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="1151.0391" y2="1151.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="1151.0391" y2="1164.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="1164.0391" y2="1164.0391"/><polygon fill="#A80036" points="494.5,1160.0391,484.5,1164.0391,494.5,1168.0391,490.5,1164.0391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="447" x="490.5" y="1130.8403">auditTaskMap.put(Replica.replicaMemberNode, new List&lt;Identifier&gt;())</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="394" x="490.5" y="1145.9731">auditTaskMap.get(Replica.replicaMemberNode).add(Identifier)</text><path d="M329,1207.0391 L407,1207.0391 L407,1214.0391 L397,1224.0391 L329,1224.0391 L329,1207.0391 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="143.5313" style="stroke:#000000;stroke-width:2.0;" width="550.5" x="329" y="1207.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="344" y="1220.106">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="345" x="422" y="1219.2495">[for each NodeReference in auditTaskMap.keySet()]</text><path d="M884.5,1212.0391 L884.5,1252.0391 L1075.5,1252.0391 L1075.5,1222.0391 L1065.5,1212.0391 L884.5,1212.0391 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M1065.5,1212.0391 L1065.5,1222.0391 L1075.5,1222.0391 L1065.5,1212.0391 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="890.5" y="1229.106">Hazelcast distributes Audit</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="890.5" y="1244.2388">Tasks to all CNs</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="1245.3047" y2="1245.3047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="1245.3047" y2="1258.3047"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="1258.3047" y2="1258.3047"/><polygon fill="#A80036" points="494.5,1254.3047,484.5,1258.3047,494.5,1262.3047,490.5,1258.3047" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="490.5" y="1240.2388">taskid = idGenerator.newId()</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="1287.4375" y2="1287.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="1287.4375" y2="1300.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="1300.4375" y2="1300.4375"/><polygon fill="#A80036" points="494.5,1296.4375,484.5,1300.4375,494.5,1304.4375,490.5,1300.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="377" x="490.5" y="1282.3716">auditTask = MNAuditTask(NodeReference, List&lt;Identifier&gt;)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="483.5" x2="525.5" y1="1329.5703" y2="1329.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="525.5" x2="525.5" y1="1329.5703" y2="1342.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="484.5" x2="525.5" y1="1342.5703" y2="1342.5703"/><polygon fill="#A80036" points="494.5,1338.5703,484.5,1342.5703,494.5,1346.5703,490.5,1342.5703" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="263" x="490.5" y="1324.5044">hzAuditTaskQueue.put(taskid, auditTask)</text><rect fill="#EEEEEE" filter="url(#f1rsammdpqe1hx)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1251.5" x="0" y="1378.1367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1251.5" y1="1378.1367" y2="1378.1367"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1251.5" y1="1381.1367" y2="1381.1367"/><rect fill="#EEEEEE" filter="url(#f1rsammdpqe1hx)" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="218" x="516.75" y="1367.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="199" x="522.75" y="1383.6372">Process Replication Tasks</text><line style="stroke:#A80036;stroke-width:1.0;" x1="949.5" x2="996.5" y1="1416.8359" y2="1416.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="996.5" x2="996.5" y1="1416.8359" y2="1429.8359"/><line style="stroke:#A80036;stroke-width:1.0;" x1="955.5" x2="996.5" y1="1429.8359" y2="1429.8359"/><polygon fill="#A80036" points="965.5,1425.8359,955.5,1429.8359,965.5,1433.8359,961.5,1429.8359" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="961.5" y="1411.77">itemAdded(task)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="954.5" x2="996.5" y1="1492.7344" y2="1492.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="996.5" x2="996.5" y1="1492.7344" y2="1505.7344"/><line style="stroke:#A80036;stroke-width:1.0;" x1="955.5" x2="996.5" y1="1505.7344" y2="1505.7344"/><polygon fill="#A80036" points="965.5,1501.7344,955.5,1505.7344,965.5,1509.7344,961.5,1505.7344" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="961.5" y="1487.6685">hzReplicationTaskQueue.poll()</text><path d="M561,1447.8359 L561,1532.8359 L935,1532.8359 L935,1457.8359 L925,1447.8359 L561,1447.8359 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M925,1447.8359 L925,1457.8359 L935,1457.8359 L925,1447.8359 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="567" y="1464.9028">Each ReplicationService polls the replication task</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="342" x="567" y="1480.0356">queue when events are fired. The first to get the lock</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="567" y="1495.1685">handles the task.  The others will also get the lock,</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="335" x="567" y="1510.3013">but during evaluation, will not create a task because</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="567" y="1525.4341">of the new state of the replica in the system metadata</text><line style="stroke:#A80036;stroke-width:1.0;" x1="954.5" x2="1001.5" y1="1558.6328" y2="1558.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1001.5" y1="1558.6328" y2="1571.6328"/><line style="stroke:#A80036;stroke-width:1.0;" x1="960.5" x2="1001.5" y1="1571.6328" y2="1571.6328"/><polygon fill="#A80036" points="970.5,1567.6328,960.5,1571.6328,970.5,1575.6328,966.5,1571.6328" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="966.5" y="1553.5669">ExecutorService.submit(task)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="959.5" x2="1001.5" y1="1605.7656" y2="1605.7656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1001.5" x2="1001.5" y1="1605.7656" y2="1618.7656"/><line style="stroke:#A80036;stroke-width:1.0;" x1="960.5" x2="1001.5" y1="1618.7656" y2="1618.7656"/><polygon fill="#A80036" points="970.5,1614.7656,960.5,1618.7656,970.5,1622.7656,966.5,1618.7656" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="966.5" y="1600.6997">replicationTask.call(pid)</text><polygon fill="#A80036" points="288.5,1643.8984,278.5,1647.8984,288.5,1651.8984,284.5,1647.8984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="282.5" x2="948.5" y1="1647.8984" y2="1647.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="294.5" y="1642.8325">replicate(cnZSession, mnASession, pid)</text><polygon fill="#A80036" points="932.5,1673.0313,942.5,1677.0313,932.5,1681.0313,936.5,1677.0313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="277.5" x2="938.5" y1="1677.0313" y2="1677.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="284.5" y="1671.9653">replicateResponse</text><line style="stroke:#A80036;stroke-width:1.0;" x1="954.5" x2="996.5" y1="1721.2969" y2="1721.2969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="996.5" x2="996.5" y1="1721.2969" y2="1734.2969"/><line style="stroke:#A80036;stroke-width:1.0;" x1="955.5" x2="996.5" y1="1734.2969" y2="1734.2969"/><polygon fill="#A80036" points="965.5,1730.2969,955.5,1734.2969,965.5,1738.2969,961.5,1734.2969" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="961.5" y="1701.0981">setReplicationStatus(session, pid,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="260" x="977.5" y="1716.231">nodeRef, ReplicationStatus.REQUESTED)</text><path d="M652,1699.0977 L652,1724.0977 L935,1724.0977 L935,1709.0977 L925,1699.0977 L652,1699.0977 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M925,1699.0977 L925,1709.0977 L935,1709.0977 L925,1699.0977 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="658" y="1716.1646">Object's system metadata get's updated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="954.5" x2="996.5" y1="1763.4297" y2="1763.4297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="996.5" x2="996.5" y1="1763.4297" y2="1776.4297"/><line style="stroke:#A80036;stroke-width:1.0;" x1="955.5" x2="996.5" y1="1776.4297" y2="1776.4297"/><polygon fill="#A80036" points="965.5,1772.4297,955.5,1776.4297,965.5,1780.4297,961.5,1776.4297" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="961.5" y="1758.3638">updateSystemMetadata(pid)</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="954.5" x2="996.5" y1="1805.5625" y2="1805.5625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="996.5" x2="996.5" y1="1805.5625" y2="1818.5625"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="955.5" x2="996.5" y1="1818.5625" y2="1818.5625"/><polygon fill="#A80036" points="965.5,1814.5625,955.5,1818.5625,965.5,1822.5625,961.5,1818.5625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="961.5" y="1800.4966">statusResponse</text><polygon fill="#A80036" points="77.5,1843.6953,67.5,1847.6953,77.5,1851.6953,73.5,1847.6953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="71.5" x2="271.5" y1="1847.6953" y2="1847.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="83.5" y="1842.6294">getReplica(mnBSession, pid)</text><polygon fill="#A80036" points="932.5,1872.8281,942.5,1876.8281,932.5,1880.8281,936.5,1876.8281" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="66.5" x2="938.5" y1="1876.8281" y2="1876.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="312" x="73.5" y="1871.7622">isNodeAuthorized(mnASession, mnBSubject, pid)</text><polygon fill="#A80036" points="77.5,1901.9609,67.5,1905.9609,77.5,1909.9609,73.5,1905.9609" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="71.5" x2="943.5" y1="1905.9609" y2="1905.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="83.5" y="1900.895">authorizationResponse</text><polygon fill="#A80036" points="255.5,1931.0938,265.5,1935.0938,255.5,1939.0938,259.5,1935.0938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61.5" x2="261.5" y1="1935.0938" y2="1935.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="68.5" y="1930.0278">replicaBytes</text><polygon fill="#A80036" points="932.5,1975.3594,942.5,1979.3594,932.5,1983.3594,936.5,1979.3594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="272.5" x2="938.5" y1="1979.3594" y2="1979.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="279.5" y="1959.1606">setReplicationStatus(session, pid,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="295.5" y="1974.2935">nodeRef, ReplicationStatus.COMPLETE)</text><polygon fill="#A80036" points="77.5,2004.4922,67.5,2008.4922,77.5,2012.4922,73.5,2008.4922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="71.5" x2="943.5" y1="2008.4922" y2="2008.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="83.5" y="2003.4263">mnA.getChecksum(pid)</text><polygon fill="#A80036" points="932.5,2038.625,942.5,2042.625,932.5,2046.625,936.5,2042.625" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="61.5" x2="938.5" y1="2042.625" y2="2042.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="65" x="68.5" y="2037.5591">checksum</text><path d="M959,2021.4922 L959,2046.4922 L1242,2046.4922 L1242,2031.4922 L1232,2021.4922 L959,2021.4922 " fill="#FBFB77" filter="url(#f1rsammdpqe1hx)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M1232,2021.4922 L1232,2031.4922 L1242,2031.4922 L1232,2021.4922 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="965" y="2038.5591">Object's system metadata get's updated</text><line style="stroke:#A80036;stroke-width:1.0;" x1="954.5" x2="996.5" y1="2076.7578" y2="2076.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="996.5" x2="996.5" y1="2076.7578" y2="2089.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="955.5" x2="996.5" y1="2089.7578" y2="2089.7578"/><polygon fill="#A80036" points="965.5,2085.7578,955.5,2089.7578,965.5,2093.7578,961.5,2089.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="961.5" y="2071.6919">updateSystemMetadata(pid)</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="954.5" x2="996.5" y1="2123.8906" y2="2123.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="996.5" x2="996.5" y1="2123.8906" y2="2136.8906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="949.5" x2="996.5" y1="2136.8906" y2="2136.8906"/><polygon fill="#A80036" points="959.5,2132.8906,949.5,2136.8906,959.5,2140.8906,955.5,2136.8906" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="961.5" y="2118.8247">statusResponse</text><!--MD5=[892287ecbac6a61d17dfc1453e3a2060]
@startuml
skinparam notebordercolor #AAAAAA
skinparam notefontcolor #222222
title Replicate an object between two Member Nodes\n\n
participant "mnA : MNode" as mnA <<MNode>>
participant "mnB : MNode" as mnB <<MNode>>
participant "cnXReplService : ReplicationService" as cnXrepl <<CNode>>
participant "cnZReplService : ReplicationService" as cnZ <<CNode>>

== Replication Event  ==
[-> cnXrepl : hzSystemMetadata.put(pid, sysmeta)
activate cnXrepl #D74F57

note right
  Synchronization services adds entry to
  SystemMetadata map managed by Hazelcast,
  EntryEvent is fired
end note

cnXrepl -> cnXrepl : entryAdded(EntryEvent<pid, sysmeta>)
cnXrepl -> cnXrepl : queueEvent(pid)
cnXrepl -> cnXrepl : itemAdded(pid)
note right
  hzReplicationEvents.offer(pid) is called to keep track of
  frequent hzSystemMetadata change events. When popped
  off of the queue, identifiers are placed into the
  hzHandledReplicationEvents set until the evaluation
  to create a task or not is complete. This prevents
  multiple task creation across CNs for the same event
end note

cnXrepl -> cnXrepl : createAndQueueTasks(pid)

loop for each ReplicationTask
cnXrepl -> cnXrepl : taskid = idGenerator.newId()
  note right
  Hazelcast.getIdGenerator("task-ids") has been
  called in ReplicationService constructor
end note
cnXrepl -> cnXrepl : hzReplicationTaskQueue.put(taskid, task)
note right
  Hazelcast distributes Replication
  Tasks to all CNs
end note
cnXrepl -> cnXrepl: setReplicationStatus(session, pid,\n    nodeRef, ReplicationStatus.QUEUED)
deactivate cnXrepl
end loop

== Regular Replication Audit ==

 [-> cnXrepl : auditReplicas()
 activate cnXrepl #D74F57

 note right
   Query the Metacat database to receive a short list of
   tasks which have not had their checksums verified in
   greater than 2 months
 end note
 cnXrepl ->] : getAuditShortList()
 cnXrepl <- -] : shortList

 note over cnXrepl
 Bin the tasks by NodeReference for
 bulk processing my MNAuditTask
 end note
 loop for each Identifier in shortList
 cnXrepl -> cnXrepl : hzSystemMetadata.get(Identifier).getReplicaList()
 loop for each Replica in List<Replica>
 alt if Replica.replicaVerified is older than 2 months
 alt if auditTaskMap.containsKey(Replica.replicaMemberNode)
 cnXrepl -> cnXrepl : auditTaskMap.get(Replica.replicaMemberNode).add(Identifier)
 else else
 cnXrepl -> cnXrepl : auditTaskMap.put(Replica.replicaMemberNode, new List<Identifier>())\nauditTaskMap.get(Replica.replicaMemberNode).add(Identifier)
 end
 end
 end loop
 end loop
 loop for each NodeReference in auditTaskMap.keySet()
 cnXrepl -> cnXrepl : taskid = idGenerator.newId()
 cnXrepl -> cnXrepl : auditTask = MNAuditTask(NodeReference, List<Identifier>)
 cnXrepl -> cnXrepl : hzAuditTaskQueue.put(taskid, auditTask)
 end loop
 note right
   Hazelcast distributes Audit
   Tasks to all CNs
 end note
 deactivate cnXrepl

== Process Replication Tasks ==

cnZ -> cnZ: itemAdded(task)
activate cnZ #D74F57
cnZ -> cnZ: hzReplicationTaskQueue.poll()
note left
  Each ReplicationService polls the replication task
  queue when events are fired. The first to get the lock
  handles the task.  The others will also get the lock,
  but during evaluation, will not create a task because
  of the new state of the replica in the system metadata
end note

cnZ -> cnZ: ExecutorService.submit(task)
activate cnZ #DarkSalmon
cnZ -> cnZ: replicationTask.call(pid)
cnZ -> mnB: replicate(cnZSession, mnASession, pid)
activate mnB #D74F57
mnB - -> cnZ: replicateResponse
deactivate cnZ
cnZ -> cnZ: setReplicationStatus(session, pid,\n    nodeRef, ReplicationStatus.REQUESTED)

note left
 Object's system metadata get's updated
end note

cnZ -> cnZ: updateSystemMetadata(pid)
cnZ - -> cnZ: statusResponse

mnB -> mnA: getReplica(mnBSession, pid)
deactivate mnB
activate mnA #D74F57
mnA -> cnZ: isNodeAuthorized(mnASession, mnBSubject, pid)
cnZ - -> mnA: authorizationResponse
mnA - -> mnB: replicaBytes
deactivate mnA
activate mnB #D74F57

mnB -> cnZ: setReplicationStatus(session, pid,\n    nodeRef, ReplicationStatus.COMPLETE)
deactivate mnB
cnZ -> mnA: mnA.getChecksum(pid)
activate mnA #D74F57
mnA - -> cnZ : checksum

note right
Object's system metadata get's updated
end note

deactivate mnA
cnZ -> cnZ: updateSystemMetadata(pid)
cnZ - -> cnZ: statusResponse
deactivate cnZ


deactivate cnZ
deactivate cnZ
@enduml

PlantUML version 1.2020.21beta3(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>