<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="862px" preserveAspectRatio="none" style="width:1029px;height:862px;" version="1.1" viewBox="0 0 1029 862" width="1029px" zoomAndPan="magnify"><defs><filter height="300%" id="f1cv4q02qfk5ap" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="392" x="316.5" y="28.708">Detailed CILogon Authentication Sequence</text><rect fill="#FFFFFF" filter="url(#f1cv4q02qfk5ap)" height="276.3594" style="stroke:#000000;stroke-width:2.0;" width="1005" x="10" y="509.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="84" x2="84" y1="91.5469" y2="802.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="219" x2="219" y1="91.5469" y2="802.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="321" x2="321" y1="331.2578" y2="802.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="489.5" x2="489.5" y1="91.5469" y2="802.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="663" x2="663" y1="91.5469" y2="802.9297"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="795" x2="795" y1="559.3516" y2="802.9297"/><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="124" x="20" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="49.5" y="59.9482">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="27" y="76.2451">IdentityService</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="124" x="20" y="801.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="65" x="49.5" y="821.9248">«CNode»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="110" x="27" y="838.2217">IdentityService</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="119" x="158" y="39.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="98" x="168.5" y="59.9482">«Application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="165" y="76.2451">Client Browser</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="119" x="158" y="801.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="98" x="168.5" y="821.9248">«Application»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="165" y="838.2217">Client Browser</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="57" x="291" y="801.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="298" y="821.9248">Portal</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="451.5" y="56.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="458.5" y="76.2451">CILogon</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="72" x="451.5" y="801.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="458.5" y="821.9248">CILogon</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="135" x="594" y="56.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="601" y="76.2451">Identity Provider</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="135" x="594" y="801.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="121" x="601" y="821.9248">Identity Provider</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="100" x="743" y="801.9297"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="750" y="821.9248">Metacat API</text><polygon fill="#A80036" points="477.5,118.6797,487.5,122.6797,477.5,126.6797,481.5,122.6797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="219.5" x2="483.5" y1="122.6797" y2="122.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="226.5" y="117.6138">Select IdP</text><polygon fill="#A80036" points="230.5,167.9453,220.5,171.9453,230.5,175.9453,226.5,171.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="224.5" x2="488.5" y1="171.9453" y2="171.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="236.5" y="166.8794">IdP Redirect</text><path d="M494,135.6797 L494,190.6797 L708,190.6797 L708,145.6797 L698,135.6797 L494,135.6797 " fill="#FBFB77" filter="url(#f1cv4q02qfk5ap)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M698,135.6797 L698,145.6797 L708,145.6797 L698,135.6797 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="500" y="152.7466">CIlogon redirect to IdP using</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="500" y="167.8794">"document.forms[0].submit()"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="500" y="183.0122">posting SAML request to IdP</text><polygon fill="#A80036" points="651.5,217.2109,661.5,221.2109,651.5,225.2109,655.5,221.2109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="219.5" x2="657.5" y1="221.2109" y2="221.2109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="226.5" y="216.145">Identity Verification</text><polygon fill="#A80036" points="230.5,266.4766,220.5,270.4766,230.5,274.4766,226.5,270.4766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="224.5" x2="662.5" y1="270.4766" y2="270.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="236.5" y="265.4106">CILogon Redirect</text><path d="M668,234.2109 L668,289.2109 L909,289.2109 L909,244.2109 L899,234.2109 L668,234.2109 " fill="#FBFB77" filter="url(#f1cv4q02qfk5ap)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M899,234.2109 L899,244.2109 L909,244.2109 L899,234.2109 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="674" y="251.2778">IdP redirect to CILogon using</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="674" y="266.4106">"document.forms[0].submit()"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="674" y="281.5435">posting SAML response to CILogon</text><polygon fill="#A80036" points="279,300.6094,289,304.6094,279,308.6094,283,304.6094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="219.5" x2="285" y1="304.6094" y2="304.6094"/><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="57" x="291" y="298.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="298" y="318.6045">Portal</text><polygon fill="#A80036" points="477.5,361.0391,487.5,365.0391,477.5,369.0391,481.5,365.0391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="321.5" x2="483.5" y1="365.0391" y2="365.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="328.5" y="359.9731">"Download Certificate"</text><polygon fill="#A80036" points="95,390.1719,85,394.1719,95,398.1719,91,394.1719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="89" x2="488.5" y1="394.1719" y2="394.1719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="101" y="389.106">getPrincipalInfo(Principal)</text><polygon fill="#A80036" points="477.5,419.3047,487.5,423.3047,477.5,427.3047,481.5,423.3047" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="84" x2="483.5" y1="423.3047" y2="423.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="91" y="418.2388">PrincipalList</text><line style="stroke:#A80036;stroke-width:1.0;" x1="489.5" x2="531.5" y1="452.4375" y2="452.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="531.5" x2="531.5" y1="452.4375" y2="465.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="490.5" x2="531.5" y1="465.4375" y2="465.4375"/><polygon fill="#A80036" points="500.5,461.4375,490.5,465.4375,500.5,469.4375,496.5,465.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="496.5" y="447.3716">Generate and Sign X.509</text><polygon fill="#A80036" points="332.5,490.5703,322.5,494.5703,332.5,498.5703,328.5,494.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="326.5" x2="488.5" y1="494.5703" y2="494.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="338.5" y="489.5044">X.509</text><path d="M10,509.5703 L258,509.5703 L258,516.5703 L248,526.5703 L10,526.5703 L10,509.5703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="276.3594" style="stroke:#000000;stroke-width:2.0;" width="1005" x="10" y="509.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="203" x="25" y="522.6372">For existing KNB identities</text><polygon fill="#A80036" points="731,543.8359,741,547.8359,731,551.8359,735,547.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="219.5" x2="737" y1="547.8359" y2="547.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="226.5" y="542.77">authenticate with KNB identity/credentials</text><rect fill="#FEFECE" filter="url(#f1cv4q02qfk5ap)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="100" x="743" y="526.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="86" x="750" y="546.6982">Metacat API</text><polygon fill="#A80036" points="230.5,589.1328,220.5,593.1328,230.5,597.1328,226.5,593.1328" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="224.5" x2="794" y1="593.1328" y2="593.1328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="236.5" y="588.0669">session</text><polygon fill="#A80036" points="309.5,618.2656,319.5,622.2656,309.5,626.2656,313.5,622.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="219.5" x2="315.5" y1="622.2656" y2="622.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="226.5" y="617.1997">get token</text><polygon fill="#A80036" points="230.5,647.3984,220.5,651.3984,230.5,655.3984,226.5,651.3984" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="224.5" x2="320.5" y1="651.3984" y2="651.3984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="236.5" y="646.3325">token</text><polygon fill="#A80036" points="783,676.5313,793,680.5313,783,684.5313,787,680.5313" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="219.5" x2="789" y1="680.5313" y2="680.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="226.5" y="675.4653">"Map Identites" (token)</text><polygon fill="#A80036" points="332.5,705.6641,322.5,709.6641,332.5,713.6641,328.5,709.6641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="326.5" x2="794" y1="709.6641" y2="709.6641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="338.5" y="704.5981">verify token</text><polygon fill="#A80036" points="783,734.7969,793,738.7969,783,742.7969,787,738.7969" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="321.5" x2="789" y1="738.7969" y2="738.7969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="328.5" y="733.731">valid token</text><polygon fill="#A80036" points="95,768.9297,85,772.9297,95,776.9297,91,772.9297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="89" x2="794" y1="772.9297" y2="772.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="101" y="767.8638">mapIdentity(MN, CILogon, KNB)</text><path d="M800,751.7969 L800,776.7969 L996,776.7969 L996,761.7969 L986,751.7969 L800,751.7969 " fill="#FBFB77" filter="url(#f1cv4q02qfk5ap)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M986,751.7969 L986,761.7969 L996,761.7969 L986,751.7969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="806" y="768.8638">using trusted MN certificate</text><!--MD5=[c436fa426b1bba34cb7e29b81bf615fb]
@startuml
title Detailed CILogon Authentication Sequence
participant "IdentityService" as IS << CNode >>
participant "Client Browser" as D1 << Application >>
participant "Portal" as Portal
participant "CILogon" as CI
participant "Identity Provider" as IP

D1->CI: Select IdP
CI- ->D1: IdP Redirect
note right
    CIlogon redirect to IdP using
    "document.forms[0].submit()"
    posting SAML request to IdP
end note
D1->IP: Identity Verification
IP- ->D1: CILogon Redirect
note right
    IdP redirect to CILogon using
    "document.forms[0].submit()"
    posting SAML response to CILogon
end note
create Portal
D1 -> Portal
Portal->CI: "Download Certificate"
CI->IS: getPrincipalInfo(Principal)
IS- ->CI: PrincipalList
CI->CI: Generate and Sign X.509
CI- ->Portal: X.509

group For existing KNB identities
  participant "Metacat API" as Metacat
  create Metacat

  D1->Metacat: authenticate with KNB identity/credentials
  D1<- -Metacat: session
  D1->Portal: get token
  D1<- -Portal: token
  D1->Metacat: "Map Identites" (token)
  Metacat->Portal: verify token
  Portal- ->Metacat: valid token
  Metacat->IS: mapIdentity(MN, CILogon, KNB)
  note right
    using trusted MN certificate
  end note
end
@enduml

PlantUML version 1.2020.21beta3(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>