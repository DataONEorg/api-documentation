<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1594px" preserveAspectRatio="none" style="width:2235px;height:1594px;" version="1.1" viewBox="0 0 2235 1594" width="2235px" zoomAndPan="magnify"><defs><filter height="300%" id="foeu6mwqwt43u" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="46" style="stroke:#A80036;stroke-width:1.0;" width="10" x="104.5" y="1479.7656"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="178.2969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="278.5" y="1347.4688"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="287.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="410" y="1238.4375"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="419.625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="591" y="1106.1406"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="212.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="717" y="1055.375"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="472.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="871.5" y="824.3125"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1039.5" y="460.7188"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="41.6992" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1039.5" y="711.3477"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="459.8242" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1163" y="124.4258"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="49.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1168" y="215.3906"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1168" y="525.9844"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="459.8242" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1452" y="124.4258"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="866.1836" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1452" y="658.582"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1732" y="293.7891"/><rect fill="#FFFFFF" filter="url(#foeu6mwqwt43u)" height="518.6563" style="stroke:#000000;stroke-width:2.0;" width="1265.5" x="955.5" y="73.5938"/><rect fill="#FFFFFF" filter="url(#foeu6mwqwt43u)" height="159.9297" style="stroke:#000000;stroke-width:2.0;" width="892.5" x="965.5" y="337.9219"/><rect fill="#FFFFFF" filter="url(#foeu6mwqwt43u)" height="911.5156" style="stroke:#000000;stroke-width:2.0;" width="1788.5" x="9" y="606.25"/><rect fill="#FFFFFF" filter="url(#foeu6mwqwt43u)" height="187.9297" style="stroke:#000000;stroke-width:2.0;" width="407.5" x="1380" y="839.3125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="109" x2="109" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="283.5" x2="283.5" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="414.5" x2="414.5" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="596" x2="596" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="721.5" x2="721.5" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="876.5" x2="876.5" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1044.5" x2="1044.5" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1167.5" x2="1167.5" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1457" x2="1457" y1="56.5938" y2="1534.7656"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1736.5" x2="1736.5" y1="56.5938" y2="1534.7656"/><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="133" x="41" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="73.5" y="24.9951">«Cluster»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="48" y="41.292">Repl Task Queue</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="133" x="41" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="73.5" y="1553.7607">«Cluster»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="48" y="1570.0576">Repl Task Queue</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="96" x="233.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="262.5" y="24.9951">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="240.5" y="41.292">Replication</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="96" x="233.5" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="262.5" y="1553.7607">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="82" x="240.5" y="1570.0576">Replication</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="139" x="343.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="379" y="24.9951">«Cluster»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="350.5" y="41.292">Index Task Queue</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="139" x="343.5" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="379" y="1553.7607">«Cluster»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="350.5" y="1570.0576">Index Task Queue</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="68" x="560" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="575" y="24.9951">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="567" y="41.292">Indexer</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="68" x="560" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="575" y="1553.7607">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="567" y="1570.0576">Indexer</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="107" x="666.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="701" y="24.9951">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="673.5" y="41.292">Object Store</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="107" x="666.5" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="701" y="1553.7607">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="673.5" y="1570.0576">Object Store</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="174" x="787.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="840.5" y="24.9951">«Cluster»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="794.5" y="41.292">System Metadata Map</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="174" x="787.5" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="840.5" y="1553.7607">«Cluster»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="160" x="794.5" y="1570.0576">System Metadata Map</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="134" x="975.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="1023.5" y="24.9951">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="982.5" y="41.292">Sync Task Queue</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="134" x="975.5" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="1023.5" y="1553.7607">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="982.5" y="1570.0576">Sync Task Queue</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="85" x="1123.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="1132" y="24.9951">«Cluster»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1130.5" y="41.292">Node Map</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="85" x="1123.5" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="1132" y="1553.7607">«Cluster»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1130.5" y="1570.0576">Node Map</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="130" x="1390" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="1436" y="24.9951">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1397" y="41.292">Synchronization</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="130" x="1390" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="38" x="1436" y="1553.7607">«CN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="1397" y="1570.0576">Synchronization</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="77" x="1696.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="40" x="1715" y="24.9951">«MN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="1703.5" y="41.292">Read API</text><rect fill="#FEFECE" filter="url(#foeu6mwqwt43u)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="77" x="1696.5" y="1533.7656"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="40" x="1715" y="1553.7607">«MN»</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="1703.5" y="1570.0576">Read API</text><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="46" style="stroke:#A80036;stroke-width:1.0;" width="10" x="104.5" y="1479.7656"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="178.2969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="278.5" y="1347.4688"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="287.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="410" y="1238.4375"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="419.625" style="stroke:#A80036;stroke-width:1.0;" width="10" x="591" y="1106.1406"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="212.1953" style="stroke:#A80036;stroke-width:1.0;" width="10" x="717" y="1055.375"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="472.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="871.5" y="824.3125"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1039.5" y="460.7188"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="41.6992" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1039.5" y="711.3477"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="459.8242" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1163" y="124.4258"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="49.2656" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1168" y="215.3906"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1168" y="525.9844"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="459.8242" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1452" y="124.4258"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="866.1836" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1452" y="658.582"/><rect fill="#D74F57" filter="url(#foeu6mwqwt43u)" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="1732" y="293.7891"/><path d="M955.5,73.5938 L1235.5,73.5938 L1235.5,80.5938 L1225.5,90.5938 L955.5,90.5938 L955.5,73.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="518.6563" style="stroke:#000000;stroke-width:2.0;" width="1265.5" x="955.5" y="73.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="235" x="970.5" y="86.6606">populateSynchronizationQueue</text><polygon fill="#A80036" points="1184,120.4258,1174,124.4258,1184,128.4258,1180,124.4258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1178" x2="1451" y1="124.4258" y2="124.4258"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="1190" y="119.3599">lock(node_id)</text><path d="M1467,95.7266 L1467,135.7266 L1665,135.7266 L1665,105.7266 L1655,95.7266 L1467,95.7266 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M1655,95.7266 L1655,105.7266 L1665,105.7266 L1655,95.7266 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="1473" y="112.7935">Start of synchronization</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="1473" y="127.9263">process triggered by quartz</text><polygon fill="#A80036" points="1440,162.125,1450,166.125,1440,170.125,1444,166.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1173" x2="1446" y1="166.125" y2="166.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="1180" y="161.0591">OK</text><polygon fill="#A80036" points="1189,211.3906,1179,215.3906,1189,219.3906,1185,215.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1183" x2="1451" y1="215.3906" y2="215.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="1195" y="210.3247">getLastUpdateTime(node_id)</text><path d="M1467,179.125 L1467,234.125 L1727,234.125 L1727,189.125 L1717,179.125 L1467,179.125 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M1717,179.125 L1717,189.125 L1727,189.125 L1717,179.125 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="1473" y="196.1919">The Node Map is a hash of</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="239" x="1473" y="211.3247">(node_id, Node), use Hazelcast query</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="1473" y="226.4575">Map.values() passing in SqlPredicate</text><polygon fill="#A80036" points="1440,260.6563,1450,264.6563,1440,268.6563,1444,264.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1173" x2="1446" y1="264.6563" y2="264.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="1180" y="259.5903">startTime</text><polygon fill="#A80036" points="1720,289.7891,1730,293.7891,1720,297.7891,1724,293.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1462" x2="1726" y1="293.7891" y2="293.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="1469" y="288.7231">listObjects(session, startTime, ...)</text><polygon fill="#A80036" points="1473,318.9219,1463,322.9219,1473,326.9219,1469,322.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1467" x2="1736" y1="322.9219" y2="322.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="1479" y="317.856">ObjectList</text><path d="M965.5,337.9219 L1043.5,337.9219 L1043.5,344.9219 L1033.5,354.9219 L965.5,354.9219 L965.5,337.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="159.9297" style="stroke:#000000;stroke-width:2.0;" width="892.5" x="965.5" y="337.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="33" x="980.5" y="350.9888">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="1058.5" y="350.1323">[for each PID]</text><path d="M1863,342.9219 L1863,427.9219 L2202,427.9219 L2202,352.9219 L2192,342.9219 L1863,342.9219 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M2192,342.9219 L2192,352.9219 L2202,352.9219 L2192,342.9219 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="1869" y="359.9888">adding SyncTasks should fail if PID is already</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="314" x="1869" y="375.1216">in the list and the PID is NOT locked. This enables</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="1869" y="390.2544">very recent updates to a PID to occur and be</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="318" x="1869" y="405.3872">correctly managed by the overall synchronization</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="1869" y="420.52">process.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1462" x2="1504" y1="397.3867" y2="397.3867"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1504" x2="1504" y1="397.3867" y2="410.3867"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1463" x2="1504" y1="410.3867" y2="410.3867"/><polygon fill="#A80036" points="1473,406.3867,1463,410.3867,1473,414.3867,1469,410.3867" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="1469" y="392.3208">createTask(PID)</text><path d="M1583,360.0547 L1583,430.0547 L1834,430.0547 L1834,370.0547 L1824,360.0547 L1583,360.0547 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M1824,360.0547 L1824,370.0547 L1834,370.0547 L1824,360.0547 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="1589" y="377.1216">Each SyncTask implements Callable</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="1589" y="392.2544">and will be submitted to the</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="1589" y="407.3872">ExecutorService to be executed</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="1589" y="422.52">on a CN</text><polygon fill="#A80036" points="1060.5,456.7188,1050.5,460.7188,1060.5,464.7188,1056.5,460.7188" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1054.5" x2="1451" y1="460.7188" y2="460.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="1066.5" y="455.6528">offer(taskid, SyncTask)</text><polygon fill="#A80036" points="1440,485.8516,1450,489.8516,1440,493.8516,1444,489.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1044.5" x2="1446" y1="489.8516" y2="489.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="1051.5" y="484.7856">OK</text><polygon fill="#A80036" points="1189,521.9844,1179,525.9844,1189,529.9844,1185,525.9844" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1183" x2="1451" y1="525.9844" y2="525.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="1195" y="520.9185">setLastUpdateTime(node_id, startTime)</text><polygon fill="#A80036" points="1440,551.1172,1450,555.1172,1440,559.1172,1444,555.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1173" x2="1446" y1="555.1172" y2="555.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="1180" y="550.0513">OK</text><polygon fill="#A80036" points="1179,580.25,1169,584.25,1179,588.25,1175,584.25" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1173" x2="1456" y1="584.25" y2="584.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="1185" y="579.1841">unlock(node_id)</text><path d="M9,606.25 L281,606.25 L281,613.25 L271,623.25 L9,623.25 L9,606.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="911.5156" style="stroke:#000000;stroke-width:2.0;" width="1788.5" x="9" y="606.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="24" y="619.3169">processSynchronizationQueue</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1457" x2="1504" y1="645.582" y2="645.582"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1504" x2="1504" y1="645.582" y2="658.582"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1463" x2="1504" y1="658.582" y2="658.582"/><polygon fill="#A80036" points="1473,654.582,1463,658.582,1473,662.582,1469,658.582" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="1469" y="640.5161">entryAdded(EntryEvent&lt;PID, SyncTask&gt;)</text><path d="M1147,628.3828 L1147,668.3828 L1443,668.3828 L1443,638.3828 L1433,628.3828 L1147,628.3828 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M1433,628.3828 L1433,638.3828 L1443,638.3828 L1433,628.3828 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="1153" y="645.4497">Synchronization implements EntryListener,</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="1153" y="660.5825">monitors the Sync Queue for changes.</text><polygon fill="#A80036" points="1060.5,707.3477,1050.5,711.3477,1060.5,715.3477,1056.5,711.3477" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1054.5" x2="1451" y1="711.3477" y2="711.3477"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="1066.5" y="706.2817">poll(timeout)</text><path d="M1467,682.6484 L1467,722.6484 L1696,722.6484 L1696,692.6484 L1686,682.6484 L1467,682.6484 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M1686,682.6484 L1686,692.6484 L1696,692.6484 L1686,682.6484 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1473" y="699.7153">Only one CN will win the poll and</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="1473" y="714.8481">process the SyncTask</text><polygon fill="#A80036" points="1440,749.0469,1450,753.0469,1440,757.0469,1444,753.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="1044.5" x2="1446" y1="753.0469" y2="753.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="61" x="1051.5" y="747.981">SyncTask</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1462" x2="1504" y1="782.1797" y2="782.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1504" x2="1504" y1="782.1797" y2="795.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1463" x2="1504" y1="795.1797" y2="795.1797"/><polygon fill="#A80036" points="1473,791.1797,1463,795.1797,1473,799.1797,1469,795.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="223" x="1469" y="777.1138">ExecutorService.submit(SyncTask)</text><polygon fill="#A80036" points="892.5,820.3125,882.5,824.3125,892.5,828.3125,888.5,824.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="886.5" x2="1451" y1="824.3125" y2="824.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="898.5" y="819.2466">lock(PID)</text><path d="M1380,839.3125 L1559,839.3125 L1559,846.3125 L1549,856.3125 L1380,856.3125 L1380,839.3125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="187.9297" style="stroke:#000000;stroke-width:2.0;" width="407.5" x="1380" y="839.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="1395" y="852.3794">ProcessPID( PID )</text><polygon fill="#A80036" points="1725,873.5781,1735,877.5781,1725,881.5781,1729,877.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1462" x2="1731" y1="877.5781" y2="877.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="1469" y="872.5122">getSystemMetadata(PID)</text><polygon fill="#A80036" points="1473,902.7109,1463,906.7109,1473,910.7109,1469,906.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1467" x2="1736" y1="906.7109" y2="906.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1479" y="901.645">SystemMetadata</text><polygon fill="#A80036" points="1725,931.8438,1735,935.8438,1725,939.8438,1729,935.8438" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1462" x2="1731" y1="935.8438" y2="935.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="1469" y="930.7778">get( PID )</text><polygon fill="#A80036" points="1473,960.9766,1463,964.9766,1473,968.9766,1469,964.9766" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1467" x2="1736" y1="964.9766" y2="964.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="1479" y="959.9106">object</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1462" x2="1504" y1="1000.1758" y2="1000.1758"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1504" x2="1504" y1="1000.1758" y2="1013.1758"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1463" x2="1504" y1="1013.1758" y2="1013.1758"/><polygon fill="#A80036" points="1473,1009.1758,1463,1013.1758,1473,1017.1758,1469,1013.1758" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="31" x="1469" y="995.1099">work</text><path d="M1512,977.9766 L1512,1017.9766 L1672,1017.9766 L1672,987.9766 L1662,977.9766 L1512,977.9766 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M1662,977.9766 L1662,987.9766 L1672,987.9766 L1662,977.9766 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="1518" y="995.0435">Check for new object,</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="1518" y="1010.1763">updates to properties</text><polygon fill="#A80036" points="738,1051.375,728,1055.375,738,1059.375,734,1055.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="732" x2="1451" y1="1055.375" y2="1055.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="353" x="744" y="1050.3091">createOrUpdate(session, PID, object, SystemMetadata)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="596" x2="643" y1="1093.1406" y2="1093.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="643" x2="643" y1="1093.1406" y2="1106.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="643" y1="1106.1406" y2="1106.1406"/><polygon fill="#A80036" points="612,1102.1406,602,1106.1406,612,1110.1406,608,1106.1406" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="608" y="1088.0747">entryAdded()</text><path d="M332,1068.375 L332,1123.375 L582,1123.375 L582,1078.375 L572,1068.375 L332,1068.375 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M572,1068.375 L572,1078.375 L582,1078.375 L572,1068.375 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="338" y="1085.4419">Indexer implements EntryListener,</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="338" y="1100.5747">monitors the System Metadata Map</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="338" y="1115.7075">for inserts, updates, deletes.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="601" x2="643" y1="1175.1055" y2="1175.1055"/><line style="stroke:#A80036;stroke-width:1.0;" x1="643" x2="643" y1="1175.1055" y2="1188.1055"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602" x2="643" y1="1188.1055" y2="1188.1055"/><polygon fill="#A80036" points="612,1184.1055,602,1188.1055,612,1192.1055,608,1188.1055" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="608" y="1170.0396">createTask(PID)</text><path d="M327,1137.7734 L327,1207.7734 L582,1207.7734 L582,1147.7734 L572,1137.7734 L327,1137.7734 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M572,1137.7734 L572,1147.7734 L582,1147.7734 L572,1137.7734 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="333" y="1154.8403">Each IndexTask implements Callable</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="333" y="1169.9731">and will be submitted to the</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="333" y="1185.106">ExecutorService to be executed</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="333" y="1200.2388">on the local CN</text><polygon fill="#A80036" points="431,1234.4375,421,1238.4375,431,1242.4375,427,1238.4375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="425" x2="590" y1="1238.4375" y2="1238.4375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="437" y="1233.3716">offer(taskid, IndexTask)</text><polygon fill="#A80036" points="1440,1263.5703,1450,1267.5703,1440,1271.5703,1444,1267.5703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="722" x2="1446" y1="1267.5703" y2="1267.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="729" y="1262.5044">OK</text><polygon fill="#A80036" points="887.5,1292.7031,877.5,1296.7031,887.5,1300.7031,883.5,1296.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="881.5" x2="1451" y1="1296.7031" y2="1296.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="893.5" y="1291.6372">unlock(PID)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="283.5" x2="330.5" y1="1334.4688" y2="1334.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="330.5" x2="330.5" y1="1334.4688" y2="1347.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="289.5" x2="330.5" y1="1347.4688" y2="1347.4688"/><polygon fill="#A80036" points="299.5,1343.4688,289.5,1347.4688,299.5,1351.4688,295.5,1347.4688" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="295.5" y="1329.4028">entryAdded()</text><path d="M19,1309.7031 L19,1364.7031 L269,1364.7031 L269,1319.7031 L259,1309.7031 L19,1309.7031 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M259,1309.7031 L259,1319.7031 L269,1319.7031 L259,1309.7031 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="25" y="1326.77">Indexer implements EntryListener,</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="25" y="1341.9028">monitors the System Metadata Map</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="184" x="25" y="1357.0356">for inserts, updates, deletes.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="288.5" x2="330.5" y1="1416.4336" y2="1416.4336"/><line style="stroke:#A80036;stroke-width:1.0;" x1="330.5" x2="330.5" y1="1416.4336" y2="1429.4336"/><line style="stroke:#A80036;stroke-width:1.0;" x1="289.5" x2="330.5" y1="1429.4336" y2="1429.4336"/><polygon fill="#A80036" points="299.5,1425.4336,289.5,1429.4336,299.5,1433.4336,295.5,1429.4336" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="295.5" y="1411.3677">createTask(PID)</text><path d="M21,1379.1016 L21,1449.1016 L269,1449.1016 L269,1389.1016 L259,1379.1016 L21,1379.1016 " fill="#FBFB77" filter="url(#foeu6mwqwt43u)" style="stroke:#AAAAAA;stroke-width:1.0;"/><path d="M259,1379.1016 L259,1389.1016 L269,1389.1016 L259,1379.1016 " fill="#FBFB77" style="stroke:#AAAAAA;stroke-width:1.0;"/><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="27" y="1396.1685">Each ReplTask implements Callable</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="27" y="1411.3013">and will be submitted to the</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="27" y="1426.4341">ExecutorService to be executed</text><text fill="#222222" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="27" y="1441.5669">on the a CN</text><polygon fill="#A80036" points="125.5,1475.7656,115.5,1479.7656,125.5,1483.7656,121.5,1479.7656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="119.5" x2="277.5" y1="1479.7656" y2="1479.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="131.5" y="1474.6997">offer(taskid, ReplTask)</text><!--MD5=[0e2b2fcceebd86f735c785c948772b6c]
@startuml
skinparam notebordercolor #AAAAAA
skinparam notefontcolor #222222

participant "Repl Task Queue" as cn_repl << Cluster >>
participant "Replication" as cn_replication << CN >>
participant "Index Task Queue" as cn_index << Cluster >>
participant "Indexer" as cn_indexer << CN >>
participant "Object Store" as cn_objs << CN >>
participant "System Metadata Map" as cn_sysmeta << Cluster >>
participant "Sync Task Queue" as cn_queue << CN >>
participant "Node Map" as cn_nodes << Cluster >>
participant "Synchronization" as cn_sync << CN >>
participant "Read API" as mn_read << MN >>

'm_crud -> c_notify: notify(session, PID, OBJECT_CREATED)
'c_notify -> cn_queue: addTask(SyncTask, node, PID)
'note right
'  notification triggered by successful
'  create operation on MN.
'end note

'm_rep -> c_notify: setReplicationStatus(token, PID, COMPLETE)
'c_notify -> cn_queue: addTask(SyncTask, node, PID)
'note right
'  notification triggered by completed
'  replication operation on MN.
'end note

group populateSynchronizationQueue
  cn_sync -> cn_nodes: lock(node_id)
  activate cn_sync #D74F57
  note right
    Start of synchronization
    process triggered by quartz
  end note
  activate cn_nodes #D74F57
  cn_nodes - -> cn_sync: OK
  cn_sync -> cn_nodes: getLastUpdateTime(node_id)
  activate cn_nodes #D74F57
  note right
    The Node Map is a hash of
    (node_id, Node), use Hazelcast query
    Map.values() passing in SqlPredicate
  end note
  cn_nodes - -> cn_sync: startTime
  deactivate cn_nodes

  cn_sync -> mn_read: listObjects(session, startTime, ...)
  activate mn_read #D74F57
  cn_sync <- - mn_read: ObjectList
  deactivate mn_read
  loop for each PID
    cn_sync -> cn_sync: createTask(PID)
  note right
    Each SyncTask implements Callable
    and will be submitted to the
    ExecutorService to be executed
    on a CN
  end note

    cn_sync -> cn_queue: offer(taskid, SyncTask)
    activate cn_queue #D74F57
    cn_queue - -> cn_sync: OK
    deactivate cn_queue
  end
  note right
    adding SyncTasks should fail if PID is already
    in the list and the PID is NOT locked. This enables
    very recent updates to a PID to occur and be
    correctly managed by the overall synchronization
    process.
  end note
  cn_sync -> cn_nodes: setLastUpdateTime(node_id, startTime)
  activate cn_nodes #D74F57
  cn_nodes - -> cn_sync: OK
  deactivate cn_nodes

  cn_sync -> cn_nodes: unlock(node_id)
  deactivate cn_sync
  deactivate cn_nodes
end

group processSynchronizationQueue
  cn_sync -> cn_sync: entryAdded(EntryEvent<PID, SyncTask>)
  note left
    Synchronization implements EntryListener,
    monitors the Sync Queue for changes.
  end note
  activate cn_sync #D74F57
  cn_sync -> cn_queue: poll(timeout)
  activate cn_queue #D74F57
  note right
    Only one CN will win the poll and
    process the SyncTask
  end note
  cn_queue - -> cn_sync: SyncTask
  deactivate cn_queue
  cn_sync -> cn_sync: ExecutorService.submit(SyncTask)
  cn_sync -> cn_sysmeta: lock(PID)
  activate cn_sysmeta #D74F57
  group ProcessPID( PID )
    cn_sync -> mn_read: getSystemMetadata(PID)
    mn_read -> cn_sync: SystemMetadata
    cn_sync -> mn_read: get( PID )
    mn_read -> cn_sync: object
    cn_sync -> cn_sync: work
    note right
      Check for new object,
      updates to properties
    end note
  end
  cn_sync -> cn_objs: createOrUpdate(session, PID, object, SystemMetadata)
  activate cn_objs #D74F57
  cn_indexer -> cn_indexer: entryAdded()
  activate cn_indexer #D74F57
  note left
    Indexer implements EntryListener,
    monitors the System Metadata Map
    for inserts, updates, deletes.
  end note
  cn_indexer -> cn_indexer: createTask(PID)
  note left
    Each IndexTask implements Callable
    and will be submitted to the
    ExecutorService to be executed
    on the local CN
  end note
  cn_indexer -> cn_index: offer(taskid, IndexTask)
  activate cn_index #D74F57
  cn_objs - -> cn_sync: OK
  deactivate cn_objs
  cn_sync -> cn_sysmeta: unlock(PID)
  deactivate cn_queue
  deactivate cn_sysmeta
  cn_replication -> cn_replication: entryAdded()
  activate cn_replication #D74F57
  note left
    Indexer implements EntryListener,
    monitors the System Metadata Map
    for inserts, updates, deletes.
  end note
  cn_replication -> cn_replication: createTask(PID)
  note left
    Each ReplTask implements Callable
    and will be submitted to the
    ExecutorService to be executed
    on the a CN
  end note
  cn_replication -> cn_repl: offer(taskid, ReplTask)
  activate cn_repl #D74F57
  deactivate cn_queue
end
deactivate cn_sync
@enduml

@startuml
skinparam notebordercolor #AAAAAA
skinparam notefontcolor #222222

participant "Repl Task Queue" as cn_repl << Cluster >>
participant "Replication" as cn_replication << CN >>
participant "Index Task Queue" as cn_index << Cluster >>
participant "Indexer" as cn_indexer << CN >>
participant "Object Store" as cn_objs << CN >>
participant "System Metadata Map" as cn_sysmeta << Cluster >>
participant "Sync Task Queue" as cn_queue << CN >>
participant "Node Map" as cn_nodes << Cluster >>
participant "Synchronization" as cn_sync << CN >>
participant "Read API" as mn_read << MN >>



group populateSynchronizationQueue
  cn_sync -> cn_nodes: lock(node_id)
  activate cn_sync #D74F57
  note right
    Start of synchronization
    process triggered by quartz
  end note
  activate cn_nodes #D74F57
  cn_nodes - -> cn_sync: OK
  cn_sync -> cn_nodes: getLastUpdateTime(node_id)
  activate cn_nodes #D74F57
  note right
    The Node Map is a hash of
    (node_id, Node), use Hazelcast query
    Map.values() passing in SqlPredicate
  end note
  cn_nodes - -> cn_sync: startTime
  deactivate cn_nodes

  cn_sync -> mn_read: listObjects(session, startTime, ...)
  activate mn_read #D74F57
  cn_sync <- - mn_read: ObjectList
  deactivate mn_read
  loop for each PID
    cn_sync -> cn_sync: createTask(PID)
  note right
    Each SyncTask implements Callable
    and will be submitted to the
    ExecutorService to be executed
    on a CN
  end note

    cn_sync -> cn_queue: offer(taskid, SyncTask)
    activate cn_queue #D74F57
    cn_queue - -> cn_sync: OK
    deactivate cn_queue
  end
  note right
    adding SyncTasks should fail if PID is already
    in the list and the PID is NOT locked. This enables
    very recent updates to a PID to occur and be
    correctly managed by the overall synchronization
    process.
  end note
  cn_sync -> cn_nodes: setLastUpdateTime(node_id, startTime)
  activate cn_nodes #D74F57
  cn_nodes - -> cn_sync: OK
  deactivate cn_nodes

  cn_sync -> cn_nodes: unlock(node_id)
  deactivate cn_sync
  deactivate cn_nodes
end

group processSynchronizationQueue
  cn_sync -> cn_sync: entryAdded(EntryEvent<PID, SyncTask>)
  note left
    Synchronization implements EntryListener,
    monitors the Sync Queue for changes.
  end note
  activate cn_sync #D74F57
  cn_sync -> cn_queue: poll(timeout)
  activate cn_queue #D74F57
  note right
    Only one CN will win the poll and
    process the SyncTask
  end note
  cn_queue - -> cn_sync: SyncTask
  deactivate cn_queue
  cn_sync -> cn_sync: ExecutorService.submit(SyncTask)
  cn_sync -> cn_sysmeta: lock(PID)
  activate cn_sysmeta #D74F57
  group ProcessPID( PID )
    cn_sync -> mn_read: getSystemMetadata(PID)
    mn_read -> cn_sync: SystemMetadata
    cn_sync -> mn_read: get( PID )
    mn_read -> cn_sync: object
    cn_sync -> cn_sync: work
    note right
      Check for new object,
      updates to properties
    end note
  end
  cn_sync -> cn_objs: createOrUpdate(session, PID, object, SystemMetadata)
  activate cn_objs #D74F57
  cn_indexer -> cn_indexer: entryAdded()
  activate cn_indexer #D74F57
  note left
    Indexer implements EntryListener,
    monitors the System Metadata Map
    for inserts, updates, deletes.
  end note
  cn_indexer -> cn_indexer: createTask(PID)
  note left
    Each IndexTask implements Callable
    and will be submitted to the
    ExecutorService to be executed
    on the local CN
  end note
  cn_indexer -> cn_index: offer(taskid, IndexTask)
  activate cn_index #D74F57
  cn_objs - -> cn_sync: OK
  deactivate cn_objs
  cn_sync -> cn_sysmeta: unlock(PID)
  deactivate cn_queue
  deactivate cn_sysmeta
  cn_replication -> cn_replication: entryAdded()
  activate cn_replication #D74F57
  note left
    Indexer implements EntryListener,
    monitors the System Metadata Map
    for inserts, updates, deletes.
  end note
  cn_replication -> cn_replication: createTask(PID)
  note left
    Each ReplTask implements Callable
    and will be submitted to the
    ExecutorService to be executed
    on the a CN
  end note
  cn_replication -> cn_repl: offer(taskid, ReplTask)
  activate cn_repl #D74F57
  deactivate cn_queue
end
deactivate cn_sync
@enduml

PlantUML version 1.2020.21beta3(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>